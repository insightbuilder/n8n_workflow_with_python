{
  "name": "sync_notion_todoist",
  "nodes": [
    {
      "parameters": {
        "url": "https://api.todoist.com/rest/v2/projects",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "options": {}
      },
      "id": "23609cf3-61e0-452b-9d58-b2218d8b6c03",
      "name": "Get projects",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -3820,
        820
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "url": "https://api.todoist.com/rest/v2/sections",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "project_id",
              "value": "={{ $json.project_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "808615d8-9fda-44c6-8c4f-81316a6e7a88",
      "name": "Get sections",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2940,
        820
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "resource": "database",
        "operation": "getAll"
      },
      "id": "01dc45a8-a736-4661-8a3f-faf7b42599c2",
      "name": "Get Notion Databases",
      "type": "n8n-nodes-base.notion",
      "position": [
        -4700,
        820
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "jsCode": "let dropDownValues = [];\n\nfor (const item of $input.all()) {\n  if (item.json.name == \"Inbox\") continue;\n  dropDownValues.push({\"option\": item.json.name});\n}\n\nreturn { \"options\": JSON.stringify(dropDownValues) };"
      },
      "id": "e28734f4-dd31-4923-9bc7-d901100427a2",
      "name": "Prep Dropdown",
      "type": "n8n-nodes-base.code",
      "position": [
        -4480,
        820
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "let dropDownValues = [];\n\nfor (const item of $input.all()) {\n  if (item.json.name == \"Inbox\") continue;\n  dropDownValues.push({\"option\": item.json.name});\n}\n\nreturn { \"options\": JSON.stringify(dropDownValues) };"
      },
      "id": "60913b41-6f86-4d8f-86e4-33897c9935f1",
      "name": "Prep Dropdown1",
      "type": "n8n-nodes-base.code",
      "position": [
        -3600,
        820
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "let sections = [];\nfor (const item of $('Get sections').all()) {\n  sections.push({ id: item.json.id, name: item.json.name }); \n}\n\nreturn { json: \n{\n  \"database_id\": $('Get Notion Database ID').first().json.database_id,\n  \"project_id\": $('Get Todoist Project ID').first().json.project_id,\n  \"sections\": sections\n}  \n};"
      },
      "id": "fb0d1882-b772-458d-ba05-62ac8e0581d6",
      "name": "Generate config",
      "type": "n8n-nodes-base.code",
      "position": [
        -2720,
        820
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "defineForm": "json",
        "jsonOutput": "=[\n   {\n      \"fieldLabel\": \"Select Notion Database\",\n      \"fieldType\": \"dropdown\",\n      \"requiredField\": true,\n      \"fieldOptions\": {\n        \"values\": {{ $json.options }}\n      }\n   }\n]",
        "options": {
          "buttonLabel": "Continue"
        }
      },
      "id": "1b1d05dc-8772-412b-ae9c-dfdf1ef5a7c5",
      "name": "Choose Notion Database",
      "type": "n8n-nodes-base.form",
      "position": [
        -4260,
        820
      ],
      "webhookId": "971affb1-c55c-4025-9b4b-743c8f3fcfcf",
      "typeVersion": 1
    },
    {
      "parameters": {
        "defineForm": "json",
        "jsonOutput": "=[\n   {\n      \"fieldLabel\": \"Select Todoist Project\",\n      \"fieldType\": \"dropdown\",\n      \"requiredField\": true,\n      \"fieldOptions\": {\n        \"values\": {{ $json.options }}\n      }\n   }\n]",
        "options": {
          "buttonLabel": "Continue"
        }
      },
      "id": "3530c51d-660d-48d3-9480-ae94e45c0fe0",
      "name": "Choose Todoist Project",
      "type": "n8n-nodes-base.form",
      "position": [
        -3380,
        820
      ],
      "webhookId": "971affb1-c55c-4025-9b4b-743c8f3fcfcf",
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "286fafb0-a200-4963-a19f-e63162c484b4",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('OAuth redirect').first().json.query.state }}",
              "rightValue": "={{ $json.state }}"
            }
          ]
        },
        "options": {}
      },
      "id": "17000838-ce67-4d9a-b879-3c8529152602",
      "name": "Verify security token",
      "type": "n8n-nodes-base.if",
      "position": [
        -3700,
        1540
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "state"
      },
      "id": "e0bfa04d-6293-4985-87cc-00ac8f6b30ae",
      "name": "Generate security token",
      "type": "n8n-nodes-base.crypto",
      "position": [
        -3920,
        1180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const staticData = $getWorkflowStaticData('global');\nstaticData.clientID = $('Todoist Webhook Setup Helper').first().json['Client ID'];\nstaticData.clientSecret = $('Todoist Webhook Setup Helper').first().json['Client secret'];\nstaticData.state = $json.state;\n\nreturn $input.item;"
      },
      "id": "363bb06f-f760-48c0-9343-6d647481e420",
      "name": "Store variables",
      "type": "n8n-nodes-base.code",
      "position": [
        -3700,
        1180
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const staticData = $getWorkflowStaticData('global');\n$input.item.json.clientID = staticData.clientID;\n$input.item.json.clientSecret = staticData.clientSecret;\n$input.item.json.state = staticData.state;\n\nreturn $input.item;"
      },
      "id": "b547f750-f33d-4b60-981d-aa1fcaf6f5f1",
      "name": "Get variables",
      "type": "n8n-nodes-base.code",
      "position": [
        -3920,
        1540
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "completion",
        "respondWith": "redirect",
        "redirectUrl": "=https://todoist.com/oauth/authorize?client_id={{ $json['Client ID'] }}&scope=task:add,data:read_write,data:delete&state={{ $json.state }}"
      },
      "id": "e867defb-a802-432d-ba5d-a564fd5ca864",
      "name": "Redirect to Auth Page",
      "type": "n8n-nodes-base.form",
      "position": [
        -3480,
        1180
      ],
      "webhookId": "41b4bc95-2938-4a53-a051-7a3079001329",
      "typeVersion": 1
    },
    {
      "parameters": {
        "multipleMethods": true,
        "httpMethod": [
          "GET"
        ],
        "path": "7aee8b09-29e3-4e12-9b66-c6e8ab080bf7",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "396ecdbe-0ec7-4389-96b3-bfd16f3119e3",
      "name": "OAuth redirect",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -4140,
        1540
      ],
      "webhookId": "7aee8b09-29e3-4e12-9b66-c6e8ab080bf7",
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://todoist.com/oauth/access_token",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "client_id",
              "value": "={{ $json.clientID }}"
            },
            {
              "name": "client_secret",
              "value": "={{ $json.clientSecret }}"
            },
            {
              "name": "code",
              "value": "={{ $('OAuth redirect').first().json.query.code }}"
            }
          ]
        },
        "options": {}
      },
      "id": "342efc9f-94ba-47fe-85a0-b7217ebf0100",
      "name": "Exchange Tokens",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -3480,
        1440
      ],
      "typeVersion": 4.2,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "=Developer App activated successfully. The window can be closed now.",
        "options": {}
      },
      "id": "296c40d3-c844-4f31-a8d0-5ccefef22f07",
      "name": "Respond with success",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -3260,
        1340
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "Something went wrong.",
        "options": {}
      },
      "id": "a7ca3eaf-14e2-4248-a85c-9dbef9e7a64b",
      "name": "Respond with error",
      "type": "n8n-nodes-base.respondToWebhook",
      "position": [
        -3260,
        1540
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "jsCode": "let database_id = null;\n\nfor (const item of $('Get Notion Databases').all()) {\n  if (item.json.name == $('Choose Notion Database').first().json['Select Notion Database']) {\n    database_id = item.json.id;\n  }\n}\n\nreturn { json: { database_id: database_id } };"
      },
      "id": "5d28d6af-3765-467a-9c94-8df94ded3218",
      "name": "Get Notion Database ID",
      "type": "n8n-nodes-base.code",
      "position": [
        -4040,
        820
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "let project_id = null;\n\nfor (const item of $('Get projects').all()) {\n  if (item.json.name == $('Choose Todoist Project').first().json['Select Todoist Project']) {\n    project_id = item.json.id;\n  }\n}\n\nreturn { json: { project_id: project_id } };"
      },
      "id": "aec98fbd-458a-479b-99f8-83f7e79574b8",
      "name": "Get Todoist Project ID",
      "type": "n8n-nodes-base.code",
      "position": [
        -3160,
        820
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "formTitle": "Notion-Todoist Sync Setup Helper",
        "formDescription": "This tool gathers all necessary information and builds a JSON config which is needed as globals in the sync workflows.",
        "formFields": {
          "values": [
            {
              "fieldLabel": " ",
              "placeholder": "Click \"Begin\" to continue"
            }
          ]
        },
        "options": {
          "buttonLabel": "Begin"
        }
      },
      "id": "3108d93c-ff77-4cd6-a267-13d1d056104d",
      "name": "Notion-Todoist Sync Setup Helper",
      "type": "n8n-nodes-base.formTrigger",
      "position": [
        -4920,
        820
      ],
      "webhookId": "7edf515f-bd69-4875-a5d8-eca8b4679896",
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "formTitle": "Todoist Webhook Setup Helper",
        "formDescription": "This tool helps activating the Todoist Webhook for a registered Developer App by connecting to the App vie OAuth.",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Client ID",
              "requiredField": true
            },
            {
              "fieldLabel": "Client secret",
              "requiredField": true
            }
          ]
        },
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "2d37a51f-daaa-4275-8a6e-eace0980b922",
      "name": "Todoist Webhook Setup Helper",
      "type": "n8n-nodes-base.formTrigger",
      "position": [
        -4140,
        1180
      ],
      "webhookId": "feb96ecb-a7c0-41d3-9368-2299cdce492e",
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "Copy this to the Globals Nodes",
        "completionMessage": "={{ $json.toJsonString() }}",
        "options": {}
      },
      "id": "82c242da-c9c6-42eb-a6ba-641d9cf8edff",
      "name": "Return config JSON",
      "type": "n8n-nodes-base.form",
      "position": [
        -2500,
        820
      ],
      "webhookId": "739f32d1-356d-429d-8698-a166485cc36f",
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": true,
        "filters": {
          "projectId": "={{ $('Globals').first().json.project_id }}"
        }
      },
      "id": "0cecce1a-fe09-4171-af6c-f375c977122f",
      "name": "Todoist",
      "type": "n8n-nodes-base.todoist",
      "position": [
        -140,
        1160
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Globals').first().json.database_id }}"
        },
        "returnAll": true,
        "simple": false,
        "filterType": "json",
        "filterJson": "={\n  \"and\": [\n    {\n      \"and\": [\n        {\n          \"property\": \"Status\",\n          \"status\": {\n            \"does_not_equal\": \"Done\"\n          }\n        },\n        {\n          \"property\": \"Status\",\n          \"status\": {\n            \"does_not_equal\": \"Obsolete\"\n          }\n        }\n      ]\n    },\n    {\n      \"or\": [\n        {\n          \"property\": \"Focus\",\n          \"checkbox\": {\n            \"equals\": true\n          }\n        },\n        {\n          \"property\": \"Due\",\n          \"date\": {\n            \"is_not_empty\": true\n          }\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "id": "f953bebd-1a3d-430d-bb6a-75cc5618dbc2",
      "name": "Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        -140,
        960
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "mergeByFields": {
          "values": [
            {
              "field1": "id",
              "field2": "id"
            }
          ]
        },
        "resolve": "mix",
        "options": {}
      },
      "id": "684e8a46-75a7-4f8b-bd92-0c4b57bf585d",
      "name": "Compare Datasets",
      "type": "n8n-nodes-base.compareDatasets",
      "position": [
        300,
        1060
      ],
      "typeVersion": 2.3
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "455d4c70-c774-44d4-b3ba-78754073c2db",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "1db31400-fe93-4620-a699-e14501f73fd0",
      "name": "Exists/Completed in Notion",
      "type": "n8n-nodes-base.if",
      "position": [
        760,
        1780
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "get",
        "taskId": "={{ $json.id }}"
      },
      "id": "cde178b1-81f3-4b55-a503-fc63fe56970e",
      "name": "Get Todoist Task",
      "type": "n8n-nodes-base.todoist",
      "maxTries": 2,
      "position": [
        1420,
        280
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 2000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "71e9af47-a275-4dd4-a984-0b7ba2cb8733",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.id }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "3a1932bb-ad79-40b3-b2b8-5b5f5361f247",
      "name": "If Todoist ID exists",
      "type": "n8n-nodes-base.if",
      "position": [
        980,
        380
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Notion').item.json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Todoist ID|rich_text",
              "textContent": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "192e9c50-e324-402b-98ba-f48dc3cfe92d",
      "name": "Store Todoist ID",
      "type": "n8n-nodes-base.notion",
      "position": [
        2080,
        380
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "operation": "reopen",
        "taskId": "={{ $json.id }}"
      },
      "id": "0a58713b-a56f-4236-b6ac-1f818c27ee82",
      "name": "Mark as Incomplete in Todoist",
      "type": "n8n-nodes-base.todoist",
      "position": [
        1860,
        80
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "operation": "close",
        "taskId": "={{ $('Todoist').item.json.id }}"
      },
      "id": "1bb3fbd4-319b-46e1-82f1-4460a0f9fa86",
      "name": "Mark as Completed in Todoist",
      "type": "n8n-nodes-base.todoist",
      "position": [
        1860,
        1680
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "operation": "delete",
        "taskId": "={{ $('Todoist').item.json.id }}"
      },
      "id": "581d1fc1-2f40-49ad-8bc1-ab4ac3eecf48",
      "name": "Delete Task in Todoist",
      "type": "n8n-nodes-base.todoist",
      "position": [
        1860,
        1880
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "82c29d85-9a23-43b5-9e04-58c123582f89",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        540,
        1880
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Globals').first().json.database_id }}"
        },
        "limit": 1,
        "simple": false,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Todoist ID|rich_text",
              "condition": "equals",
              "richTextValue": "={{ $('Todoist').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "5335128d-e0b8-42db-b92c-c8a41d25e253",
      "name": "Get Notion Task",
      "type": "n8n-nodes-base.notion",
      "position": [
        760,
        1980
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "alwaysOutputData": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $json.toJsonString() }}",
        "options": {}
      },
      "id": "e5d0e6a2-7440-4a37-89e2-120c56f9ded7",
      "name": "Update Task in Todoist",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        760,
        1080
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "18fbd156-06db-4991-bee7-14d8bde6bbf5",
              "name": "id",
              "type": "string",
              "value": "={{ $json.id }}"
            },
            {
              "id": "a0c01dca-6cfa-4461-8c93-fe3f2191d624",
              "name": "content",
              "type": "string",
              "value": "={{ $json.content }}"
            },
            {
              "id": "a9bae78e-1a70-4b8e-be0c-ce74e546b0de",
              "name": "priority",
              "type": "string",
              "value": "={{ $json.priority }}"
            },
            {
              "id": "6ed4364e-6f62-464d-a841-e520b5bf3d96",
              "name": "due_datetime",
              "type": "string",
              "value": "={{ $if($json.due.datetime !== undefined, $json.due.datetime.toDateTime().toISO(), $json.due.date) }}"
            },
            {
              "id": "23035cde-aea0-459d-9886-06cd7f20dd61",
              "name": "description",
              "type": "string",
              "value": "={{ $json.description }}"
            },
            {
              "id": "6795fa58-4d52-4e88-8a1c-10e574ed2c3d",
              "name": "section_id",
              "type": "string",
              "value": "={{ $json.section_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f27efc05-2452-4eb0-ad79-7a5a80742e54",
      "name": "Pick Todoist Fields",
      "type": "n8n-nodes-base.set",
      "position": [
        80,
        1160
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals').first().json;\nconst properties = $json.properties;\n\nlet output = {};\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[↗ Open in Notion](\" + $json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Set UTC if time is set\noutput.due_datetime = null;\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start;\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n}\n\nreturn { json: output };"
      },
      "id": "684df373-8ebe-4987-9846-5eca039b57e4",
      "name": "Map Notion to Todoist",
      "type": "n8n-nodes-base.code",
      "position": [
        80,
        960
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $json.toJsonString() }}",
        "options": {}
      },
      "id": "6ebadde8-96be-445a-ad22-d3c949926ba8",
      "name": "Update task in Todoist before closing",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1420,
        1680
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals').first().json;\nconst properties = $json.properties;\n\nlet output = {};\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[↗ Open in Notion](\" + $json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Set UTC if time is set\noutput.due_datetime = null;\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start;\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n}\n\nreturn { json: output };"
      },
      "id": "84f74b2f-6ce4-42d2-b123-fb368d188be8",
      "name": "Map Notion to Todoist1",
      "type": "n8n-nodes-base.code",
      "position": [
        980,
        1680
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
      },
      "id": "10fef08f-871e-424a-b604-f57728000ccf",
      "name": "Handle empty dates",
      "type": "n8n-nodes-base.code",
      "position": [
        540,
        1080
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
      },
      "id": "4b93b7db-4a0e-42be-a058-e6a8aae53438",
      "name": "Handle empty dates1",
      "type": "n8n-nodes-base.code",
      "position": [
        1200,
        1680
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// API requires due_string instead of due_datetime when date/time is removed\nif ($json.due_datetime === null) {\n  delete $json.due_datetime;\n  $input.item.json.due_string = \"no date\";\n}\n\nreturn $input.item;"
      },
      "id": "ffe7b992-2096-44a0-b4a3-632fa0ca262d",
      "name": "Handle empty dates2",
      "type": "n8n-nodes-base.code",
      "position": [
        540,
        380
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $('If Todoist ID exists').item.json.toJsonString() }}",
        "options": {}
      },
      "id": "d026c7cc-5517-46e2-991d-9af80b27e229",
      "name": "Create task in Todoist",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        1860,
        280
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "38aef493-8125-46fd-82bc-93c6d7d6f66e",
              "name": "project_id",
              "type": "string",
              "value": "={{ $('Globals').first().json.project_id }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "a1f9b303-ad82-44bd-b8d6-6d413431a17e",
      "name": "Add project ID",
      "type": "n8n-nodes-base.set",
      "position": [
        760,
        380
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 15
      },
      "id": "cadacbb5-4df5-4feb-83dd-f7f7fbb0f09f",
      "name": "Lock Todoist ID",
      "type": "n8n-nodes-base.redis",
      "position": [
        2080,
        180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "uuid"
      },
      "id": "a4a02dd0-a5da-4db1-913b-937ea3340fb0",
      "name": "Generate UUID",
      "type": "n8n-nodes-base.crypto",
      "position": [
        2960,
        480
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.todoist.com/sync/v9/sync",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "commands",
              "value": "={{ $json.commands.toJsonString() }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c1622084-fd32-4b6f-aa70-3d42a2a05e14",
      "name": "Update section (Sync API)",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        3620,
        480
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist').item.json.section_id }}",
              "rightValue": "={{ $json.section_id }}"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "cd8748c2-9b90-498c-b064-9e8a1f8c4a7b",
      "name": "Status changed",
      "type": "n8n-nodes-base.filter",
      "position": [
        980,
        1080
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "commands",
        "options": {}
      },
      "id": "4d130466-58c3-4752-97b2-caf6a61644d7",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        3400,
        480
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={\n    \"type\": \"item_move\",\n    \"uuid\": \"{{ $json.uuid }}\",\n    \"args\": {\n      \"id\": \"{{ $('Merge').item.json.item.id }}\",\n      \"section_id\": \"{{ $json.item.section_id }}\"\n    }\n  }\n",
        "options": {}
      },
      "id": "91c8375c-b365-4816-ae7e-51b7c7296e9e",
      "name": "Prepare Batching Items",
      "type": "n8n-nodes-base.set",
      "position": [
        3180,
        480
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "batchSize": 100,
        "options": {}
      },
      "id": "fd2f4ff0-24d5-4aab-94b8-32197b10292b",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        2740,
        380
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a4a40d08-7929-46da-8369-c6d33b14e4f3",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Exists/Completed in Notion').item.json.properties['Status'].status.name }}",
              "rightValue": "Done"
            }
          ]
        },
        "options": {}
      },
      "id": "f4d2c7f2-5505-4d68-a100-6809c28f717c",
      "name": "Status is Done",
      "type": "n8n-nodes-base.if",
      "position": [
        1640,
        1780
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 15
      },
      "id": "89a94e2e-6906-484f-81b0-13784d4d33cb",
      "name": "Lock Todoist ID1",
      "type": "n8n-nodes-base.redis",
      "position": [
        1640,
        1580
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=lock_{{ $('Compare Datasets').item.json.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 15
      },
      "id": "f592568c-bf13-46a9-ae3e-04110443ecdd",
      "name": "Lock Todoist ID2",
      "type": "n8n-nodes-base.redis",
      "position": [
        980,
        880
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks/{{ $('If Todoist ID exists').item.json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $('If Todoist ID exists').item.json.toJsonString() }}",
        "options": {}
      },
      "id": "39a3d964-9d3a-4357-86d4-f53e601d1d63",
      "name": "Update task in Todoist",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2080,
        -20
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7419f1e6-2978-4e4d-9147-61dcb693260b",
              "name": "item",
              "type": "object",
              "value": "={{ $('Map Notion to Todoist').item.json }}"
            },
            {
              "id": "7684427f-3267-4092-a5d3-0d13fe4e2ebb",
              "name": "action",
              "type": "string",
              "value": "reopened"
            }
          ]
        },
        "options": {}
      },
      "id": "a0ef6d6d-8d3d-49a6-a5ea-33fc309b488e",
      "name": "Get mapped item",
      "type": "n8n-nodes-base.set",
      "position": [
        2300,
        -20
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7679df9c-ccdb-425c-ad60-c8bd85379e87",
              "name": "item",
              "type": "object",
              "value": "={{ $('Map Notion to Todoist').item.json }}"
            },
            {
              "id": "d6bc106f-ed01-49be-9c27-13429684d573",
              "name": "action",
              "type": "string",
              "value": "updated_status"
            }
          ]
        },
        "options": {}
      },
      "id": "85dcb0ad-9d03-42df-add6-e383d4712d44",
      "name": "Get mapped item1",
      "type": "n8n-nodes-base.set",
      "position": [
        1880,
        1080
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 6
            }
          ]
        }
      },
      "id": "e2bf09ae-e805-4ea5-9766-0356726cf355",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -360,
        1060
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2d823132-c41f-4685-9443-8ee143809ccb",
              "name": "item",
              "type": "object",
              "value": "={{ $('Map Notion to Todoist').item.json }}"
            },
            {
              "id": "45b155c2-4254-45b3-bdd4-127ee356f8d4",
              "name": "action",
              "type": "string",
              "value": "updated"
            }
          ]
        },
        "options": {}
      },
      "id": "d8959e2d-7983-4c0c-b846-0afff8051e70",
      "name": "Prepare summary data",
      "type": "n8n-nodes-base.set",
      "position": [
        980,
        1280
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9614bc29-d8fa-4531-a8fc-5974f58e0f7a",
              "name": "item",
              "type": "object",
              "value": "={{ $('Todoist').item.json }}"
            },
            {
              "id": "6c0ffc23-a595-49ce-82b9-b02c3f9766d8",
              "name": "action",
              "type": "string",
              "value": "completed"
            }
          ]
        },
        "options": {}
      },
      "id": "e6b01482-7f0f-4797-811e-a4f0c8c7296d",
      "name": "Prepare summary data1",
      "type": "n8n-nodes-base.set",
      "position": [
        2080,
        1680
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {},
      "id": "62ed5b14-6a47-4f2e-924b-0db9b4ff259d",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "position": [
        2520,
        380
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "833becab-363d-48f1-8911-12abd34f16a0",
              "name": "item",
              "type": "object",
              "value": "={{ $('Todoist').item.json }}"
            },
            {
              "id": "306997a6-442e-44cc-ace1-c9bfe83ef28e",
              "name": "action",
              "type": "string",
              "value": "deleted"
            }
          ]
        },
        "options": {}
      },
      "id": "593502f2-b3b9-4ff2-88f1-7496766530f7",
      "name": "Prepare summary data2",
      "type": "n8n-nodes-base.set",
      "position": [
        2080,
        1880
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "db22023d-a3ff-4891-8c14-5316be7e5334",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $json.action }}",
              "rightValue": "updated_status"
            }
          ]
        },
        "options": {}
      },
      "id": "c6993723-b52e-48f9-8466-445976c61883",
      "name": "Filter out status changes",
      "type": "n8n-nodes-base.filter",
      "position": [
        2980,
        1280
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals').first().json;\nlet eventData = $json.item;\n\nlet output = {};\n\noutput.name = eventData.content\n\n// Map priority\noutput.priority = {\n  \"4\": \"do first\", // P1\n  \"3\": \"urgent\", // P2\n  \"2\": \"important\" // P3\n}[eventData.priority] ?? \"\"; // P4\n\n// Map section\nconst sectionId = eventData.section_id;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.id, section.name])\n);\n\noutput.status = \"Backlog\";\nif (sectionId !== null) {\n  if (!sectionMap.hasOwnProperty(sectionId)) {\n    //throw new Error(\"No status name found for section ID '\" + sectionId + \"'\");\n  }\n  output.status = sectionMap[sectionId];\n}\n\n// Since there is no Done section in Todoist, override status if completed\nif (eventData.is_completed) {\n  output.status = \"Done\";\n}\n\nif ($json.action == \"deleted\") {\n  output.status = \"Obsolete\";\n}\n\n// Format due date\noutput.due = eventData.due ? eventData.due.date : eventData.due_datetime || \"\"\n\nreturn { json: output };"
      },
      "id": "c36345a8-24a3-4603-9139-7143978b4287",
      "name": "Map Todoist to Notion",
      "type": "n8n-nodes-base.code",
      "position": [
        3200,
        1280
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e0fcdd39-1bd8-44e7-b84f-0b6ba834fb46",
              "name": "name",
              "type": "string",
              "value": "=<a href=\"{{ $('Merge summary').item.json.item.description.extractUrl().replaceAll(')', '') }}\">{{ $json.name }}</a>"
            },
            {
              "id": "f3bdfee8-1671-4e80-b8da-febe6f463756",
              "name": "priority",
              "type": "string",
              "value": "={{ $json.priority }}"
            },
            {
              "id": "060bfe55-0dfa-406b-99cc-ad8592a209dc",
              "name": "status",
              "type": "string",
              "value": "={{ $json.status }}"
            },
            {
              "id": "7b0ee321-0631-4cde-b1a7-b3547aff3561",
              "name": "due",
              "type": "string",
              "value": "={{ $if(!$json.due, '', $if($json.due.length > 10, $json.due.toDateTime().toLocaleString({ dateStyle: 'medium', timeStyle: 'short' }), $json.due.toDateTime().toLocaleString({ dateStyle: 'medium' }))) }}"
            },
            {
              "id": "11184572-1126-4b21-aa72-1540969200f3",
              "name": "action",
              "type": "string",
              "value": "={{ $('Merge summary').item.json.action }}"
            }
          ]
        },
        "options": {}
      },
      "id": "97605fae-06d3-41fe-b26e-d1ab668b01cd",
      "name": "Map summary fields",
      "type": "n8n-nodes-base.set",
      "position": [
        3420,
        1280
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "operation": "convertToHtmlTable",
        "options": {
          "capitalize": true
        }
      },
      "id": "5a3756a4-6545-4a46-be56-efc5997474af",
      "name": "Convert to HTML Table",
      "type": "n8n-nodes-base.html",
      "position": [
        3640,
        1280
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "html": "<!DOCTYPE html>\n<html>\n<head>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            margin: 0;\n            padding: 20px;\n        }\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n            background-color: #ffffff;\n            padding: 20px;\n            border-radius: 5px;\n            box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n        }\n        h1 {\n            color: #2c3e50;\n            text-align: center;\n            margin-bottom: 30px;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #3498db;\n        }\n        table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 20px;\n        }\n        th {\n            background-color: #3498db;\n            color: white;\n            padding: 12px;\n            text-align: left;\n        }\n        td {\n            padding: 10px;\n            border-bottom: 1px solid #ddd;\n        }\n        tr:nth-child(even) {\n            background-color: #f9f9f9;\n        }\n        tr:hover {\n            background-color: #f5f5f5;\n        }\n        a {\n            color: #333;\n            text-decoration: underline;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>Notion-Todoist Sync Report</h1>\n        <p>The following changes have been applied to Todoist:</p>\n        {{ $json.table }}\n    </div>\n</body>\n</html>\n"
      },
      "id": "196ef7bd-f281-47e7-9a53-9acd1d8fac89",
      "name": "Generate email body",
      "type": "n8n-nodes-base.html",
      "position": [
        3860,
        1280
      ],
      "typeVersion": 1.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7679df9c-ccdb-425c-ad60-c8bd85379e87",
              "name": "item",
              "type": "object",
              "value": "={{ $('Map Notion to Todoist').item.json }}"
            },
            {
              "id": "d6bc106f-ed01-49be-9c27-13429684d573",
              "name": "action",
              "type": "string",
              "value": "created"
            }
          ]
        },
        "options": {}
      },
      "id": "dac6de4b-cc23-441c-802d-c77b2976a546",
      "name": "Get mapped item2",
      "type": "n8n-nodes-base.set",
      "position": [
        2300,
        380
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "subject": "Notion-Todoist Sync Report",
        "message": "={{ $json.html }}",
        "options": {
          "appendAttribution": false
        }
      },
      "id": "0e6ebf3d-d848-400c-9af0-d637c046c99a",
      "name": "Gmail",
      "type": "n8n-nodes-base.gmail",
      "position": [
        4080,
        1280
      ],
      "webhookId": "5af8a60e-a295-40c1-8f03-0a920ba1de17",
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "numberInputs": 5
      },
      "id": "d178d890-152a-439d-b6c3-8377361eabc6",
      "name": "Merge summary",
      "type": "n8n-nodes-base.merge",
      "position": [
        2760,
        1240
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "content": "## Keep in sync\nif you update the mapping, make sure to change it in the other node as well!",
        "height": 300,
        "width": 220,
        "color": 7
      },
      "id": "26e14bc9-8791-45ee-8662-4f20ff989794",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        20,
        820
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Keep in sync\nif you update the mapping, make sure to change it in the other node as well!",
        "height": 300,
        "width": 220,
        "color": 7
      },
      "id": "3135f740-fe14-42a0-8b7a-d52cd1224ae6",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        920,
        1540
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes",
        "height": 300,
        "width": 220
      },
      "id": "9f086257-3f58-4ef3-8c3b-72816c9da57b",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -200,
        580
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"database_id\": \"165beaa8f4448063be17d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}",
        "options": {}
      },
      "id": "4130bbee-0407-4048-8bd1-c61f537eba5f",
      "name": "Globals",
      "type": "n8n-nodes-base.set",
      "position": [
        -140,
        720
      ],
      "executeOnce": false,
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "content": "Update section for each task in Todoist using the Sync API in full sync mode. Use batching and split into multiple batches, if needed, since there is a request limit of 100 full syncs within a 15 minute period.",
        "height": 380,
        "width": 1100,
        "color": 7
      },
      "id": "3ed25a4b-790a-4ed3-b98c-f7c5cb4239ad",
      "name": "Sticky Note14",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2680,
        300
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# Unidirectional sync from Notion to Todoist",
        "height": 2420,
        "width": 4760,
        "color": 5
      },
      "id": "f0da2c2a-36e2-4a0d-a625-466bda441522",
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -480,
        -180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Get open/incomplete tasks from both Notion and Todoist",
        "height": 440,
        "width": 220,
        "color": 7
      },
      "id": "ac69fb4e-74e1-4647-a049-d53e3d2b0207",
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -200,
        880
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Generate an email report containing all changes made by this workflow, since changes in Todoist are being overwritten.",
        "height": 220,
        "width": 1100,
        "color": 7
      },
      "id": "303294cb-e372-4adb-8f98-1ec32fa161a7",
      "name": "Sticky Note17",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2920,
        1220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {},
      "id": "ba38e938-8a0a-4f72-9c19-8b794d0e7a0d",
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        -320,
        4100
      ],
      "typeVersion": 1,
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "db8871d6-7f3f-468e-9a6e-3975c9f003f5",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Todoist to Notion1').item.json.name }}",
              "rightValue": "={{ $json.name }}"
            },
            {
              "id": "df493beb-52a8-47f7-90c6-fb5786b1deed",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Todoist to Notion1').item.json.priority }}",
              "rightValue": "={{ $json.property_priority }}"
            },
            {
              "id": "8942df51-6aa3-46d6-91f3-c6949bfd2361",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Todoist to Notion1').item.json.status }}",
              "rightValue": "={{ $json.property_status }}"
            },
            {
              "id": "5484e1f8-4fbc-4c63-829a-4b45b9090702",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $if($('Map Todoist to Notion1').item.json.due !== null, $('Map Todoist to Notion1').item.json.due.toDateTime().toISO(), null) }}",
              "rightValue": "={{ $if($json.property_due !== null, $json.property_due.start.toDateTime().toISO(), null) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2be39ae9-fd43-4f53-b127-8145fe6425d3",
      "name": "Differences exist1",
      "type": "n8n-nodes-base.filter",
      "position": [
        3860,
        3280
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b9e134c4-66a7-4a83-8372-282c19fdc98e",
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Get Todoist Task1').item.json.is_completed }}",
              "rightValue": "={{ $if($json.property_status == \"Done\", true, false) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "547eb32f-799c-4f24-8749-5c16664227f6",
      "name": "Requires completion change1",
      "type": "n8n-nodes-base.filter",
      "position": [
        3860,
        3660
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Globals1').first().json.database_id }}"
        },
        "title": "={{ $('Map Todoist to Notion1').item.json.name }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Todoist ID|rich_text",
              "textContent": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}"
            },
            {
              "key": "Priority|select",
              "selectValue": "={{ $('Map Todoist to Notion1').item.json.priority }}"
            },
            {
              "key": "Status|status",
              "statusValue": "={{ $('Map Todoist to Notion1').item.json.status }}"
            },
            {
              "key": "Due|date",
              "includeTime": "={{ $('Map Todoist to Notion1').item.json.due !== null && $('Map Todoist to Notion1').item.json.due.length > 10 }}",
              "date": "={{ $('Map Todoist to Notion1').item.json.due || '' }}"
            },
            {
              "key": "Focus|checkbox",
              "checkboxValue": true
            }
          ]
        },
        "options": {}
      },
      "id": "a5acb797-bd40-4a68-afe7-02c6f1ee831f",
      "name": "Create task in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4300,
        2780
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Name|title",
              "title": "={{ $('Map Todoist to Notion1').item.json.name }}"
            },
            {
              "key": "Priority|select",
              "selectValue": "={{ $('Map Todoist to Notion1').item.json.priority }}"
            },
            {
              "key": "Status|status",
              "statusValue": "={{ $('Map Todoist to Notion1').item.json.status }}"
            },
            {
              "key": "Due|date",
              "includeTime": "={{ $('Map Todoist to Notion1').item.json.due !== null && $('Map Todoist to Notion1').item.json.due.length > 10 }}",
              "date": "={{ $ifEmpty($('Map Todoist to Notion1').item.json.due, \"\") }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b161f8f0-8f4b-4f9f-891c-969b0e526d2d",
      "name": "Update task in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4520,
        3280
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|status",
              "statusValue": "Done"
            }
          ]
        },
        "options": {}
      },
      "id": "c0433b19-aae9-4346-823b-b7a563966b67",
      "name": "Mark as Done in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4520,
        3940
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|status",
              "statusValue": "Obsolete"
            }
          ]
        },
        "options": {}
      },
      "id": "1d3a998a-e533-4180-9f3d-cb23e1cacbcb",
      "name": "Mark as Obsolete in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4520,
        4260
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Status|status",
              "statusValue": "In progress"
            }
          ]
        },
        "options": {}
      },
      "id": "9dca9412-06d7-49b8-ab44-bf1709eca40a",
      "name": "Mark as In Progress in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4520,
        3740
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.item }}",
              "rightValue": "={{ null }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7b381c9f-7fbe-423f-8a5f-1db7a1dbbfe3",
      "name": "Only continue if not locked",
      "type": "n8n-nodes-base.filter",
      "position": [
        740,
        3460
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=lock_{{ $json.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 15
      },
      "id": "a3a54b4f-44a9-42fa-b5ab-2b229b520174",
      "name": "Lock Notion ID",
      "type": "n8n-nodes-base.redis",
      "position": [
        5180,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "item",
        "key": "=lock_{{ $json.body.event_data.id }}",
        "keyType": "string",
        "options": {}
      },
      "id": "fff369bc-da34-4301-ab37-7be14930cd50",
      "name": "Check if Todoist ID is locked",
      "type": "n8n-nodes-base.redis",
      "position": [
        520,
        3460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "update",
        "taskId": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}",
        "updateFields": {
          "description": "={{ \"[↗ Open in Notion](\" + $('Create task in Notion').item.json.url + \")\" }}"
        }
      },
      "id": "00a3d264-d412-4353-9040-ff0a2608d539",
      "name": "Update Description in Todoist",
      "type": "n8n-nodes-base.todoist",
      "position": [
        4740,
        2780
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "db8871d6-7f3f-468e-9a6e-3975c9f003f5",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Get Todoist Task1').item.json.description }}",
              "rightValue": "={{ \"[↗ Open in Notion](\" + $json.url + \")\" }}"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "6baede5e-35a4-48fb-8af7-675d254dca32",
      "name": "Description has changed in Todoist",
      "type": "n8n-nodes-base.filter",
      "position": [
        3860,
        3480
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "update",
        "taskId": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}",
        "updateFields": {
          "description": "={{ \"[↗ Open in Notion](\" + $json.url + \")\" }}"
        }
      },
      "id": "cb5bc788-242f-4595-b862-9ba06589351c",
      "name": "Update Description in Todoist1",
      "type": "n8n-nodes-base.todoist",
      "position": [
        4080,
        3480
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "uuid"
      },
      "id": "a80e3086-a73e-4734-82e6-2cdcf74d801c",
      "name": "Generate UUID1",
      "type": "n8n-nodes-base.crypto",
      "position": [
        4300,
        3000
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.todoist.com/sync/v9/sync",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "commands",
              "value": "=[ { \"type\": \"item_move\", \"uuid\": \"{{ $json.uuid }}\", \"args\": { \"id\": \"{{ $('Map Todoist to Notion1').item.json.todoist_id }}\", \"section_id\": \"{{ $json.section_id }}\" } }]"
            }
          ]
        },
        "options": {}
      },
      "id": "e5801f76-91dd-4895-aabb-a5b2dad4e012",
      "name": "Update section (Sync API)1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        4520,
        3000
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals1').first().json;\n\nlet output = {};\n\nconst statusName = $('Map Todoist to Notion1').item.json.status;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.name, section.id])\n);\nif (!sectionMap.hasOwnProperty(statusName)) {\n    throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n}\noutput.section_id = sectionMap[statusName];\n\nreturn { json: output };"
      },
      "id": "bc804ba2-ce8e-42e3-b148-797e2f6becfb",
      "name": "Get Backlog Section ID",
      "type": "n8n-nodes-base.code",
      "position": [
        4080,
        3000
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "27ce7ba1-43e5-4534-a759-1bafb979c190",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "5fc5f72f-52a3-4076-8358-01f61cb30d4d",
      "name": "Notion Task not found",
      "type": "n8n-nodes-base.if",
      "position": [
        3160,
        3320
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "item",
        "key": "=creating_for_{{ $('Todoist trigger reference').item.json.body.event_data.id }}",
        "keyType": "string",
        "options": {}
      },
      "id": "458cc838-8e2f-4b32-b253-3cda2e063c03",
      "name": "Check if creating flag exists1",
      "type": "n8n-nodes-base.redis",
      "position": [
        3420,
        3000
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.item }}",
              "rightValue": "={{ null }}"
            }
          ]
        },
        "options": {}
      },
      "id": "4d095d85-1c54-4565-8e3f-dfdd42b66541",
      "name": "Only continue if flag does not exist1",
      "type": "n8n-nodes-base.filter",
      "position": [
        3640,
        3000
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=creating_for_{{ $('Todoist trigger reference').item.json.body.event_data.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 10
      },
      "id": "3e753ce1-f368-4e62-8bab-c563b7b3edfe",
      "name": "Set creating flag1",
      "type": "n8n-nodes-base.redis",
      "position": [
        3860,
        3000
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "95c47aa4-249c-4235-89c2-44c16c5b65bb",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              },
              "leftValue": "={{ $json.property_focus }}",
              "rightValue": ""
            },
            {
              "id": "a611c1d2-d01a-4f5a-8ad8-cfaa65b11202",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.property_due }}",
              "rightValue": ""
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "764cf874-220e-40ee-ae72-2e9fbf26d8c0",
      "name": "Neither focussed nor planned1",
      "type": "n8n-nodes-base.filter",
      "position": [
        4300,
        3580
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $json.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Focus|checkbox",
              "checkboxValue": true
            }
          ]
        },
        "options": {}
      },
      "id": "85fa9971-0e90-4849-816f-d09c08b2e521",
      "name": "Mark as Focussed in Notion",
      "type": "n8n-nodes-base.notion",
      "position": [
        4520,
        3480
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {},
      "id": "9fef9ca2-4224-43da-9112-ef83a76ddf42",
      "name": "Todoist trigger reference",
      "type": "n8n-nodes-base.noOp",
      "position": [
        80,
        3460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Globals1').first().json.database_id }}"
        },
        "limit": 1,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Todoist ID|rich_text",
              "condition": "equals",
              "richTextValue": "={{ $('Todoist trigger reference').item.json.body.event_data.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2d30e9c8-a486-4627-85bd-299235a65963",
      "name": "Get Notion Task2",
      "type": "n8n-nodes-base.notion",
      "position": [
        3640,
        4260
      ],
      "typeVersion": 2.2,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "d644079f-b140-42b3-85c5-f1283a6d21d8",
              "operator": {
                "type": "object",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "b04eb9d8-8f09-40a9-9e13-b856b412cc5b",
      "name": "Notion Task found1",
      "type": "n8n-nodes-base.filter",
      "position": [
        3860,
        4260
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "4ffd3f5d-dc24-47cb-a4df-1a6f6a6dc2b9",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                    "rightValue": "item:updated"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "item:updated"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "d5290195-6595-4c91-af86-6df724bb0980",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                    "rightValue": "item:completed"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "item:completed"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "e047ade5-ce68-4bc8-b799-7130bd0eb917",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
                    "rightValue": "item:uncompleted"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "item:uncompleted"
            }
          ]
        },
        "options": {}
      },
      "id": "f66b65d4-da67-49e5-b401-0b0864116472",
      "name": "Switch by Event",
      "type": "n8n-nodes-base.switch",
      "position": [
        3640,
        3480
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "4fb65ecf-dbb9-4bd1-a5a8-614441aa2963",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Todoist trigger reference').item.json.body.event_name }}",
              "rightValue": "item:deleted"
            }
          ]
        },
        "options": {}
      },
      "id": "699d5e22-bd03-47f9-87e0-e9a4a3a251b2",
      "name": "If event is not :deleted",
      "type": "n8n-nodes-base.if",
      "position": [
        960,
        3460
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "database_id",
              "value": "={{ $('Globals1').first().json.database_id }}"
            },
            {
              "key": "project_id",
              "value": "={{ $('Globals1').first().json.project_id }}"
            },
            {
              "key": "todoist_id",
              "value": "={{ $json.body.event_data.id }}"
            },
            {
              "key": "source",
              "value": "Todoist"
            }
          ]
        }
      },
      "id": "b93c71fd-a1d3-43f6-ad3f-d7338e49dc44",
      "name": "Execution Data",
      "type": "n8n-nodes-base.executionData",
      "position": [
        300,
        3460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "task_name",
              "value": "={{ $json.name }}"
            }
          ]
        }
      },
      "id": "a8b4531c-01d5-4512-8309-bb4450ca4446",
      "name": "Execution Data1",
      "type": "n8n-nodes-base.executionData",
      "position": [
        2720,
        3320
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "notion_id",
              "value": "={{ $json.id }}"
            }
          ]
        }
      },
      "id": "44d1d87b-2776-4dfd-a1e4-cf10d595a28f",
      "name": "Execution Data2",
      "type": "n8n-nodes-base.executionData",
      "position": [
        4520,
        2780
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "notion_id",
              "value": "={{ $json.id }}"
            }
          ]
        }
      },
      "id": "d678fdd5-db6d-46ec-a918-c1d4a6c7a22d",
      "name": "Execution Data3",
      "type": "n8n-nodes-base.executionData",
      "position": [
        3420,
        3480
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "notion_id",
              "value": "={{ $json.id }}"
            },
            {
              "key": "task_name",
              "value": "={{ $json.name }}"
            }
          ]
        }
      },
      "id": "b2621bd3-d6fd-4a26-b3d1-3d0f4fde9a46",
      "name": "Execution Data4",
      "type": "n8n-nodes-base.executionData",
      "position": [
        4080,
        4260
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"database_id\": \"165beaa8-f444-8063-be17-d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}",
        "options": {}
      },
      "id": "44c995e3-0a10-426e-820f-6cf02ba94766",
      "name": "Globals1",
      "type": "n8n-nodes-base.set",
      "position": [
        300,
        3200
      ],
      "executeOnce": true,
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes",
        "height": 300,
        "width": 220
      },
      "id": "b0bc7ea2-c2bf-4ed1-b55e-8d0a5a461d65",
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        240,
        3060
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals1').first().json;\nlet eventData = $json;\n\nlet output = {};\n\noutput.todoist_id = eventData.id;\n\noutput.name = eventData.content\n\n// Map priority\noutput.priority = {\n  \"4\": \"do first\", // P1\n  \"3\": \"urgent\", // P2\n  \"2\": \"important\" // P3\n}[eventData.priority] ?? \"\"; // P4\n\n// Map section\nconst sectionId = eventData.section_id;\nconst sectionMap = Object.fromEntries(\n    globals.sections.map(section => [section.id, section.name])\n);\n\noutput.status = \"Backlog\";\nif (sectionId !== null) {\n  if (!sectionMap.hasOwnProperty(sectionId)) {\n    throw new Error(\"No status name found for section ID '\" + sectionId + \"'\");\n  }\n  output.status = sectionMap[sectionId];\n}\n\n// Since there is no Done section in Todoist, override status if completed\nif (eventData.is_completed) {\n  output.status = \"Done\";\n}\n\n// Map date and time\noutput.due = null;\nif (eventData.due !== null) {\n  output.due = eventData.due.date\n  if (eventData.due.datetime !== undefined) {\n    output.due = eventData.due.datetime\n  }\n}\n\nreturn { json: output };"
      },
      "id": "34586078-26ab-4ea9-b1a4-006aac500867",
      "name": "Map Todoist to Notion1",
      "type": "n8n-nodes-base.code",
      "position": [
        2500,
        3320
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "get",
        "taskId": "={{ $('Todoist trigger reference').item.json.body.event_data.id }}"
      },
      "id": "6b39f9fe-d20d-46e1-bd78-4a3d31f36e48",
      "name": "Get Todoist Task1",
      "type": "n8n-nodes-base.todoist",
      "maxTries": 3,
      "position": [
        1620,
        3320
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Globals1').first().json.database_id }}"
        },
        "limit": 1,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "Todoist ID|rich_text",
              "condition": "equals",
              "richTextValue": "={{ $('Map Todoist to Notion1').item.json.todoist_id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7e288848-6103-4def-bb97-fb3853ba2b71",
      "name": "Get Notion Task1",
      "type": "n8n-nodes-base.notion",
      "position": [
        2940,
        3320
      ],
      "typeVersion": 2.2,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "content": "Store more information, which was not available earlier",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "c697666c-59cf-4607-9a0d-810546846c9a",
      "name": "Sticky Note23",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2660,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Set focussed flag, so it remains in Todoist even after updating in Notion",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "1f431e79-a7cd-47d5-88ba-2c429c7ad767",
      "name": "Sticky Note26",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4240,
        2700
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Create Notion page** if it does not exist",
        "height": 760,
        "width": 1800,
        "color": 7
      },
      "id": "6c0ec38a-2dcb-4b52-ba45-7c1b999d23fe",
      "name": "Sticky Note27",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3340,
        2440
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Update Notion page** if it needs to be changed",
        "height": 900,
        "width": 1340,
        "color": 7
      },
      "id": "f6d94001-5b62-4354-baea-cbb3e07ab4ef",
      "name": "Sticky Note28",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3340,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Checking for a cached flag in Redis, to prevent overrides and endless loops.",
        "height": 280,
        "width": 440,
        "color": 7
      },
      "id": "59d43c17-384d-4378-a8c7-59bc27970424",
      "name": "Sticky Note29",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        460,
        3360
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Retrieve Notion page, so it can be compared against",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "fb07c392-2dd0-4c43-b680-47ac6220a992",
      "name": "Sticky Note31",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2880,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store more information, which was not available earlier",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "265ad811-15cc-4d9b-8dbd-01ce96fb71af",
      "name": "Sticky Note32",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3360,
        3380
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store relevant information in highlighted execution data, in case of debugging",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "53b54a6f-8c7b-4805-9b13-1639c593fa02",
      "name": "Sticky Note33",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        240,
        3360
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Trigger based synchronization from Todoist to Notion (part of bi-directional sync)",
        "height": 2160,
        "width": 5880,
        "color": 5
      },
      "id": "6ab20bf6-aafe-4aa5-b3cf-563986ca2e28",
      "name": "Sticky Note35",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -480,
        2340
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Following nodes reference to this node, so the trigger can easily be replaced",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "4ec80270-a1a2-4cbe-a6d6-40911f3f4540",
      "name": "Sticky Note36",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        20,
        3360
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "This prevents the creation of duplicates in Notion, by storing a special flag in Redis containing the Todoist ID",
        "height": 240,
        "width": 660,
        "color": 7
      },
      "id": "fdcee2c4-9121-41d0-8433-4e2f211dd271",
      "name": "Sticky Note37",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3360,
        2940
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b9e134c4-66a7-4a83-8372-282c19fdc98e",
              "operator": {
                "type": "boolean",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.is_completed }}",
              "rightValue": "={{ $json.is_completed }}"
            }
          ]
        },
        "options": {}
      },
      "id": "e60c61be-ff9f-476f-add8-19a9a38c03f8",
      "name": "Requires completion change",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1900,
        3120
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a8595a9c-fc03-4bb1-b1fc-ecde223d19aa",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.is_completed }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "8f6be344-13bb-4d6e-816a-bd7239ede6d2",
      "name": "Has been completed?",
      "type": "n8n-nodes-base.if",
      "position": [
        -1680,
        3120
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "or",
          "conditions": [
            {
              "id": "3a400a40-a25b-4e88-81ba-1aa9ada9d3aa",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.content }}",
              "rightValue": "={{ $json.content }}"
            },
            {
              "id": "8a649292-a21e-4d3f-9e3c-0047b21a7487",
              "operator": {
                "type": "number",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.priority }}",
              "rightValue": "={{ $json.priority }}"
            },
            {
              "id": "65f02b94-18de-4883-b5b1-f58fe5459828",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.due_datetime || null }}",
              "rightValue": "={{ $json.due === null ? null : $json.due.date}}"
            },
            {
              "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
              "rightValue": "={{ $json.section_id }}"
            },
            {
              "id": "0b24cd35-b8b0-4d21-943c-fad905c4542a",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.description }}",
              "rightValue": "={{ $json.description }}"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "22559d93-8e62-4995-b292-3dd95d4ed4d6",
      "name": "Differences exist",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1900,
        2820
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.item }}",
              "rightValue": "={{ null }}"
            }
          ]
        },
        "options": {}
      },
      "id": "6c8f0c35-020d-42d2-a35a-769c39fe7398",
      "name": "Only continue if not locked1",
      "type": "n8n-nodes-base.filter",
      "position": [
        -4800,
        3600
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "item",
        "key": "=lock_{{ $json.body.data.id }}",
        "keyType": "string",
        "options": {}
      },
      "id": "af8b2349-e241-42fb-95e2-851cf8a6e069",
      "name": "Check if Notion ID is locked",
      "type": "n8n-nodes-base.redis",
      "position": [
        -5020,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "get",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Notion trigger reference').item.json.body.data.id }}"
        },
        "simple": false
      },
      "id": "fcb77d34-39ad-411d-a9d0-cb917ca6d4b3",
      "name": "Get Notion task",
      "type": "n8n-nodes-base.notion",
      "maxTries": 2,
      "position": [
        -4580,
        3600
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "item",
        "key": "=creating_for_{{ $('Notion trigger reference').item.json.body.data.id }}",
        "keyType": "string",
        "options": {}
      },
      "id": "d4234b6f-9513-4f02-a279-a3a530def15a",
      "name": "Check if creating flag exists",
      "type": "n8n-nodes-base.redis",
      "position": [
        -1680,
        3960
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6b3359cb-c8fc-4663-b2a9-e367ad4fcba5",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $json.item }}",
              "rightValue": "={{ null }}"
            }
          ]
        },
        "options": {}
      },
      "id": "4998c28b-f8f3-4c2a-9105-54cd106360bd",
      "name": "Only continue if flag does not exist",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1460,
        3960
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=creating_for_{{ $('Notion trigger reference').item.json.body.data.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 10
      },
      "id": "6cb0ae66-792e-4d81-8b4d-276213e49dcf",
      "name": "Set creating flag",
      "type": "n8n-nodes-base.redis",
      "position": [
        -1240,
        3960
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "8b074088-25e0-4975-9356-bd2d9c17c0d3",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.id }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "85eed866-05d6-4304-b97c-d376a9d8031b",
      "name": "Todoist ID exists?",
      "type": "n8n-nodes-base.if",
      "position": [
        -3480,
        3800
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "be85c68d-e9a8-4a88-ae12-54ec9cc685e5",
              "name": "id",
              "type": "string",
              "value": "={{ $('Get Todoist Task2').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "bc83b868-1461-44e0-bd65-aa7925c70355",
      "name": "Get todoist ID",
      "type": "n8n-nodes-base.set",
      "position": [
        -1240,
        3120
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "d20ece89-96d3-4324-894f-860711138952",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $json.id }}",
              "rightValue": ""
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "ee09cdff-72d1-4a67-ba21-df0576c8a108",
      "name": "Todoist ID exists",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1900,
        2560
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "be85c68d-e9a8-4a88-ae12-54ec9cc685e5",
              "name": "id",
              "type": "string",
              "value": "={{ $('Todoist ID exists').item.json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7a2382ac-1e0a-4fb2-8796-8fa9a7add8d2",
      "name": "Get todoist ID1",
      "type": "n8n-nodes-base.set",
      "position": [
        -1240,
        2560
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
              "rightValue": "={{ $json.section_id }}"
            },
            {
              "id": "2ea2a63b-9968-4f95-af48-fc71fa210ffd",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              },
              "leftValue": "={{ $('Map Notion to Todoist2').item.json.section_id }}",
              "rightValue": ""
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "3c554695-5d8f-4470-be65-0d999ec13b7d",
      "name": "Status changed but not empty",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1900,
        3460
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "9118fe29-c592-430e-8877-57cb81e6bf75",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $('Get Notion task').item.json.properties['Status'].status.name }}",
              "rightValue": "Obsolete"
            }
          ]
        },
        "options": {}
      },
      "id": "b49ecf8f-5f03-4596-b9b3-d26bf91af00f",
      "name": "Status is Obsolete?",
      "type": "n8n-nodes-base.if",
      "position": [
        -3920,
        3600
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "e3225b20-c6b6-479b-a0b5-dc9725197521",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              },
              "leftValue": "={{ $('Get Notion task').item.json.properties['Status'].status.name }}",
              "rightValue": "Done"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "90c2bf04-0a94-4df0-9eec-5479cb72e4fb",
      "name": "Status is not Done",
      "type": "n8n-nodes-base.filter",
      "position": [
        -1900,
        3800
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "990a9ac6-c358-4aae-8c4e-4c49f9830ef5",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $('Get Notion task').item.json.properties.Due.date }}",
              "rightValue": ""
            },
            {
              "id": "93c8c7eb-1979-4eaf-90a6-be659290cded",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              },
              "leftValue": "={{ $('Get Notion task').item.json.properties.Focus.checkbox }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "a1f47a61-7fe4-4719-ae2c-5577488a80ed",
      "name": "Neither focussed nor planned",
      "type": "n8n-nodes-base.if",
      "position": [
        -3700,
        3700
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {},
      "id": "af55e4a7-5b7d-48f3-a2df-f622c930fddd",
      "name": "Notion trigger reference",
      "type": "n8n-nodes-base.noOp",
      "position": [
        -5460,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "7e1a4d8a-9cdc-4991-817c-1429ccfbece2",
        "options": {}
      },
      "id": "9988688c-99ec-438c-8e85-be3b09e49664",
      "name": "Notion Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -6340,
        3600
      ],
      "webhookId": "7e1a4d8a-9cdc-4991-817c-1429ccfbece2",
      "typeVersion": 2
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Notion trigger reference').item.json.body.data.id }}"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Todoist ID|rich_text",
              "textContent": "={{ $json.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d96e7ac8-a158-4fcf-b6fe-f60309448177",
      "name": "Store Todoist ID1",
      "type": "n8n-nodes-base.notion",
      "position": [
        -800,
        4060
      ],
      "retryOnFail": true,
      "typeVersion": 2.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "operation": "close",
        "taskId": "={{ $('Get Todoist Task2').item.json.id }}"
      },
      "id": "5247ee40-df09-4343-9375-90ffd7943d58",
      "name": "Mark as Completed in Todoist1",
      "type": "n8n-nodes-base.todoist",
      "position": [
        -1460,
        3020
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks/{{ $json.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $('Map Notion to Todoist2').item.json.toJsonString() }}",
        "options": {}
      },
      "id": "691a869e-7546-49b9-86f9-c66b486f7cda",
      "name": "Update task in Todoist1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1460,
        2820
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "{\n  \"database_id\": \"165beaa8-f444-8063-be17-d105a9898961\",\n  \"project_id\": \"2327925123\",\n  \"sections\": [\n    {\"id\": \"177308158\", \"name\": \"Backlog\"},\n    {\"id\": \"175778849\", \"name\": \"In progress\"},\n    {\"id\": \"175778857\", \"name\": \"On hold\"}\n  ]\n}",
        "options": {}
      },
      "id": "bb1111e9-6393-4834-8e8d-d9efcbf0c2ef",
      "name": "Globals2",
      "type": "n8n-nodes-base.set",
      "position": [
        -5240,
        3340
      ],
      "executeOnce": true,
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "operation": "reopen",
        "taskId": "={{ $json.id }}"
      },
      "id": "991fae55-61b4-4d77-b6b4-ccb14522be09",
      "name": "Mark as Incomplete in Todoist1",
      "type": "n8n-nodes-base.todoist",
      "position": [
        -1460,
        3220
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "action": "generate",
        "dataPropertyName": "uuid"
      },
      "id": "8277d296-2eef-4fab-9535-17a1d193e238",
      "name": "Generate UUID2",
      "type": "n8n-nodes-base.crypto",
      "position": [
        -1680,
        3460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.todoist.com/sync/v9/sync",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "commands",
              "value": "=[ { \"type\": \"item_move\", \"uuid\": \"{{ $json.uuid }}\", \"args\": { \"id\": \"{{ $('Get Todoist Task2').item.json.id }}\", \"section_id\": \"{{ $('Map Notion to Todoist2').item.json.section_id }}\" } }]"
            }
          ]
        },
        "options": {}
      },
      "id": "9a78550c-cae3-49f4-beb2-8b3106b289b8",
      "name": "Update section (Sync API)2",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1460,
        3460
      ],
      "typeVersion": 4.2
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=lock_{{ $json.id }}",
        "value": "={{ $now.toISO() }}",
        "keyType": "string",
        "expire": true,
        "ttl": 15
      },
      "id": "0122103e-49fe-4faf-9546-eef39421f2e4",
      "name": "Lock Todoist ID4",
      "type": "n8n-nodes-base.redis",
      "position": [
        -800,
        3140
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "delete",
        "taskId": "={{ $json.id }}"
      },
      "id": "9646b1bd-acc1-44a6-8210-4b5738c24057",
      "name": "Delete Task in Todoist2",
      "type": "n8n-nodes-base.todoist",
      "position": [
        -1460,
        2560
      ],
      "retryOnFail": true,
      "typeVersion": 2.1,
      "waitBetweenTries": 3000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "const globals = $('Globals2').first().json;\nconst properties = $('Get Notion task').item.json.properties;\n\nlet output = {};\n\noutput.project_id = globals.project_id;\n\noutput.id = properties['Todoist ID'].rich_text.length > 0 ? \n  properties['Todoist ID'].rich_text[0].text.content : \n  null;\n\noutput.content = properties['Name'].title.length > 0 ? properties['Name'].title[0].text.content : '[empty]';\n\noutput.description = \"[↗ Open in Notion](\" + $('Get Notion task').item.json.url + \")\"\n\n// Map priority\nif (properties['Priority'].select === null) {\n  output.priority = \"1\"; // P4\n} else {\n  output.priority = {\n    \"do first\": \"4\", // P1\n    \"urgent\": \"3\", // P2\n    \"important\": \"2\" // P3\n  }[properties['Priority'].select.name] ?? \"1\"; // P4\n}\n\n// Map section\nconst statusName = properties['Status'].status.name;\noutput.section_id = null;\nif (!['Done', 'Obsolete'].includes(statusName)) {\n  const sectionMap = Object.fromEntries(\n      globals.sections.map(section => [section.name, section.id])\n  );\n  if (!sectionMap.hasOwnProperty(statusName)) {\n      throw new Error(\"No Todoist section found for status '\" + statusName + \"'\");\n  }\n  output.section_id = sectionMap[statusName];\n}\n\n// Map completed by status \"Done\"\noutput.is_completed = false;\nif (properties['Status'].status.name == \"Done\") {\n  output.is_completed = true;\n}\n\n// Set UTC if time is set\nif (properties['Due'].date !== null) {\n  output.due_datetime = properties.Due.date.start\n  if (properties.Due.date.start.length > 10) {\n    output.due_datetime = new Date(properties.Due.date.start).toISOString();\n  }\n} else {\n  // API requires due_string instead of due_datetime when date/time is removed\n  output.due_string = \"no date\";\n}\n\nreturn { json: output };"
      },
      "id": "68c8d2cd-540b-4e1a-81c6-4ec393e9423f",
      "name": "Map Notion to Todoist2",
      "type": "n8n-nodes-base.code",
      "position": [
        -4360,
        3600
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "get",
        "taskId": "={{ $json.id }}"
      },
      "id": "45c3eaae-e769-48c9-a65e-90edbe6f8c8c",
      "name": "Get Todoist Task2",
      "type": "n8n-nodes-base.todoist",
      "position": [
        -2820,
        3700
      ],
      "typeVersion": 2.1,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.todoist.com/rest/v2/tasks",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "todoistApi",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={{ $('Map Notion to Todoist2').item.json.toJsonString() }}",
        "options": {}
      },
      "id": "c95f0725-02ff-4eed-8d1f-674a21b5224f",
      "name": "Create task in Todoist1",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1020,
        3960
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "waitBetweenTries": 3000
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "database_id",
              "value": "={{ $('Globals2').first().json.database_id }}"
            },
            {
              "key": "project_id",
              "value": "={{ $('Globals2').first().json.project_id }}"
            },
            {
              "key": "notion_id",
              "value": "={{ $json.body.data.id }}"
            },
            {
              "key": "source",
              "value": "Notion"
            }
          ]
        }
      },
      "id": "6b85d582-f891-44a3-a7e3-2c6c5c5282ff",
      "name": "Execution Data5",
      "type": "n8n-nodes-base.executionData",
      "position": [
        -5240,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "todoist_id",
              "value": "={{ $json.id }}"
            },
            {
              "key": "task_name",
              "value": "={{ $json.content }}"
            }
          ]
        }
      },
      "id": "d253df1f-9142-4981-82a1-87ce5e4af718",
      "name": "Execution Data6",
      "type": "n8n-nodes-base.executionData",
      "position": [
        -4140,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Update section for in Todoist using the Sync API in full sync mode (**maximum of 100 requests within a 15 minute period!**)",
        "height": 220,
        "width": 440,
        "color": 7
      },
      "id": "b6613d6f-fe90-4c47-9d90-c6214a36a577",
      "name": "Sticky Note22",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1740,
        3400
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Delete the task** if it does not fit into the filter anymore",
        "height": 300,
        "width": 900,
        "color": 7
      },
      "id": "0432ae32-ffa1-4858-ba58-da6e59d68ee3",
      "name": "Sticky Note24",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1980,
        2440
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Update the task** if it needs to be changed",
        "height": 880,
        "width": 900,
        "color": 7
      },
      "id": "d2bb1dda-cda7-48e8-a356-afb6a492edcc",
      "name": "Sticky Note25",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1980,
        2760
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Notion tries to deliver webhooks again. To ensure the data is up to date, the payload must be retrieved again.",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "8a4300b6-c149-4f05-8440-7e1d3aeb6109",
      "name": "Sticky Note38",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4640,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Set Globals\nUse Sync Setup Helper Workflow to generate the JSON and paste it in every Globals Nodes",
        "height": 300,
        "width": 220
      },
      "id": "e0f0b707-e305-471d-aeaf-ff043203715c",
      "name": "Sticky Note39",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5300,
        3200
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Continues on error, so it is not necessary to retrieve task beforehand",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "68cbc63e-451e-4b9d-872e-dbf3f174bda4",
      "name": "Sticky Note41",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1520,
        2480
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Following nodes reference to this node, so the trigger can easily be replaced",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "2168d686-5062-407c-855d-a76cf6d2104d",
      "name": "Sticky Note42",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5520,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store relevant information in highlighted execution data, in case of debugging",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "fb952001-e06f-4a93-be60-87b96fa91de9",
      "name": "Sticky Note43",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5300,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store more information, which was not available earlier",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "4e19fb8a-35c0-46e7-95fb-93a49b7a5929",
      "name": "Sticky Note44",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4200,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Instead of deleting pages in Notion, it is a safer practice to mark them as obsolete instead.",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "617fd194-43ed-4991-aa00-472d6290695d",
      "name": "Sticky Note45",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3980,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "In rare cases Notion fires multiple webhooks within a short period of time, when creating a new task. This prevents the creation of duplicates in Todoist.",
        "height": 260,
        "width": 660,
        "color": 7
      },
      "id": "c5c3e466-704f-4608-9574-31bd5383a143",
      "name": "Sticky Note46",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1740,
        3880
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "The mapping is more advanced and also includes fall-back values for edge-cases",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "11f7579c-0263-400f-9e25-f22c0602fb05",
      "name": "Sticky Note47",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4420,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Checking for a cached flag in Redis, to prevent overrides and endless loops.",
        "height": 280,
        "width": 440,
        "color": 7
      },
      "id": "5099bf8e-e689-49e4-af6d-95103f3c44f8",
      "name": "Sticky Note48",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5080,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# Trigger based synchronization from Notion to Todoist (part of bi-directional sync)",
        "height": 1960,
        "width": 5880,
        "color": 5
      },
      "id": "fb750ec9-bd5a-4c6a-a4e0-9c4d6a14aaf7",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6460,
        2340
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Configure Webhook\nGrab the webhook URL and use it in the Notion automation. If using the NotionWebhookEmulator instead, replace this node with the nodes shown below.",
        "height": 400,
        "width": 220
      },
      "id": "749b04d2-6689-4e44-85a7-78e4b0513be9",
      "name": "Sticky Note20",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6400,
        3380
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Only sync focussed & planned tasks for efficiency reasons",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "6a53cbcb-a5fa-4cc5-9e36-dd558384f97d",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3760,
        3600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "The mapping between the Notion and Todoist tasks is stored in Notion",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "72f091a6-e195-465c-ae54-53379fa09611",
      "name": "Sticky Note19",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3540,
        3680
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "The Todoist ID is being cached in Redis for 15 seconds, so the other Diff sync does not get triggered.",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "af88bce0-959a-4f77-b35f-ae0a262e5cda",
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -860,
        3020
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Create task** if it does not exist (anymore)",
        "height": 580,
        "width": 1340,
        "color": 7
      },
      "id": "4885a1d7-63ee-4c5a-a86a-e8ade52e9ee9",
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1980,
        3660
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Edge case: the task has been moved from Obsolete to Done",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "5b619a25-897a-4b81-962c-8b593b699000",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1960,
        3720
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Todoist Webhook Router Example (optional)\nSince Todoist sends the updates of all projects to a single webhook, the requests need to be routed accordingly.\nTo do so, create a separate workflow, each containing the flow above, except replace the webhook and switch nodes with an \"Execute Workflow Trigger\".\nThen activate the nodes below and configure it, so it calls the sub-workflows accordingly.",
        "height": 700,
        "width": 1020,
        "color": 7
      },
      "id": "18b50bba-8410-48f1-b7f1-36f9250f2b47",
      "name": "Sticky Note49",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -420,
        3740
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Using the event type from Todoist is the only option to actually recognize, if a task was deleted",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "8e78dea5-078d-43e3-a89a-640f56ed5512",
      "name": "Sticky Note51",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        900,
        3360
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "The mapping is more advanced and also includes fall-back values for edge-cases",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "426af651-9ab0-457f-8b34-88c7528eeee4",
      "name": "Sticky Note52",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2440,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Previous node always returns output data, since it uses a filter to retrieve a matching item",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "e8e61d6a-aca1-4b4a-bde1-c4f9ba840e5e",
      "name": "Sticky Note53",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3100,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Reverse mapping the Section/Status",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "25741dba-ab2a-4173-a62b-5e4f2f62c664",
      "name": "Sticky Note54",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4020,
        2940
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Update section for in Todoist using the Sync API in full sync mode (**maximum of 100 requests within a 15 minute period!**)",
        "height": 240,
        "width": 440,
        "color": 7
      },
      "id": "1fad92ed-3058-4e82-ab77-ef11052ad097",
      "name": "Sticky Note55",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4240,
        2940
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store more information, which was not available earlier",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "04d2ab6c-b816-47d9-9dad-f5065d4b1406",
      "name": "Sticky Note56",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4460,
        2700
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "The Notion ID is being cached in Redis for 15 seconds, so the other Diff sync does not get triggered.",
        "height": 280,
        "width": 220,
        "color": 7
      },
      "id": "9dc90e21-ea07-426c-a79a-567aa2a4bef7",
      "name": "Sticky Note57",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        5120,
        3480
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "**Delete Notion page** if Todoist task has been deleted",
        "height": 320,
        "width": 1340,
        "color": 7
      },
      "id": "ca2bd9bd-b9b1-459c-a615-0d35231b5d9f",
      "name": "Sticky Note58",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3340,
        4140
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Store more information, which was not available earlier",
        "height": 260,
        "width": 220,
        "color": 7
      },
      "id": "d89eabc1-252e-4d56-aecf-c637dec7a75c",
      "name": "Sticky Note59",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4020,
        4180
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "47b150f3-12a3-4fe9-97cc-5d139daa3b00",
        "options": {}
      },
      "id": "03a62862-2a17-43a2-a7c5-4bb789fa74d8",
      "name": "Todoist Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -360,
        3460
      ],
      "webhookId": "81107d16-d839-4507-a627-f607f1d53d4e",
      "typeVersion": 2
    },
    {
      "parameters": {
        "content": "Handle tasks **only found in Notion**. This can still mean, that the task exists in Todoist, but does not match the filter, since it has been completed. In that case the Todoist task is being retrieved. If it exist, the Todoist Task will be reopened, otherwise it will be created.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered.",
        "height": 860,
        "width": 1980,
        "color": 7
      },
      "id": "d2d3d7e3-0a79-4036-be0e-9438fa040330",
      "name": "Sticky Note60",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        480,
        -80
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Handle tasks which show **differences** between both systems. If there are differences, the Todoist task will be overwritten by all properties from Notion. Also the status is being updated in the following step accordingly.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered.",
        "height": 640,
        "width": 1760,
        "color": 7
      },
      "id": "5958359b-21c0-4e04-8e9e-c6248b638594",
      "name": "Sticky Note61",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        480,
        800
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Handle tasks **only found in Todoist**. This can still mean, that the task exists in Notion, but does not match the filter, since it has been completed. In that case the Notion page is being retrieved. If it does not exist, because it was deleted, the Todoist Task will be deleted as well.\nThe Todoist ID is being cached in Redis for 15 seconds, so the Diff sync does not get triggered.",
        "height": 720,
        "width": 1760,
        "color": 7
      },
      "id": "96aa9249-a81e-4e71-9abf-9f34ec9ebb3a",
      "name": "Sticky Note62",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        480,
        1460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Set Schedule\nSet the preferred period. Usually once a day, likely outside working hours should be a solid option.",
        "height": 280,
        "width": 220
      },
      "id": "6895b74f-bece-4854-bfb5-4c3bb4eccedd",
      "name": "Sticky Note63",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -420,
        920
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Preparing data for comparing",
        "height": 200,
        "width": 220,
        "color": 7
      },
      "id": "9529383b-645e-4d4d-9e5f-b7f96af5fe71",
      "name": "Sticky Note64",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        140,
        1240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Set mail address\nProvide the email address where the report should be sent to. This node can also be replaced by an SMTP or similar node.",
        "height": 320,
        "width": 220
      },
      "id": "942efdff-14e8-467c-a22d-22ed3c114cba",
      "name": "Sticky Note65",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4020,
        1120
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "mode": "id",
          "value": ""
        },
        "options": {}
      },
      "id": "f08c0a1a-ff83-4902-a047-e9ff7cbdffc0",
      "name": "Execute Workflow",
      "type": "n8n-nodes-base.executeWorkflow",
      "position": [
        400,
        4000
      ],
      "typeVersion": 1.1,
      "disabled": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7f0c61dc-87ae-4fbe-9e40-d9d27a0d61a8",
              "name": "body.data.id",
              "type": "string",
              "value": "={{ $json.data.id }}"
            }
          ]
        },
        "options": {}
      },
      "id": "81f5108c-1a53-41dd-9056-8832d831cfdf",
      "name": "Extract IDs",
      "type": "n8n-nodes-base.set",
      "position": [
        -5680,
        3500
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "fieldToSplitOut": "body",
        "options": {}
      },
      "id": "a86f8546-f054-406f-813c-3f20b8b97410",
      "name": "Split out Notion changes",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        -5900,
        3500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "0479a702-9ec0-4203-bcaa-e4bdbd872f4e",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              },
              "leftValue": "={{ $json.body[0] }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "4bf2a926-7a75-4786-85a1-612c40529db2",
      "name": "Body is array?",
      "type": "n8n-nodes-base.if",
      "position": [
        -6120,
        3600
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "If consuming data from the Notion Webhook Emulator instead of a regular Notion Webhook, the data is structured differently and can contain multiple items. This section makes the workflow compatible with both approaches.",
        "height": 340,
        "width": 660,
        "color": 7
      },
      "id": "f593500f-b399-470b-bd30-c14af0c12f43",
      "name": "Sticky Note66",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -6180,
        3440
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "loose"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.body.event_data.project_id }}",
                    "rightValue": "2346249328"
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "[project name]"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "1bcbf94f-d3d6-44df-a53d-97943afc464f",
      "name": "Switch by project",
      "type": "n8n-nodes-base.switch",
      "position": [
        -140,
        3460
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "content": "## Register Webhook in Todoist App\nGrab the URL from here and add it to the Todosit developer app as described in the setup instructions",
        "height": 400,
        "width": 220
      },
      "id": "e2e0787e-9d93-4f45-bcf4-dfbc1b296048",
      "name": "Sticky Note21",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -420,
        3240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Set project ID and name\nThe ID can be copied from JSON in Globals Node.\nIf syncing multiple Todoist projects, use the router described below.",
        "height": 400,
        "width": 220
      },
      "id": "e0fa2061-674e-467b-905f-6b9a69885fb0",
      "name": "Sticky Note67",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -200,
        3240
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "path": "1d758ef5-a9b9-4313-b81e-1c7dfe230a33",
        "options": {}
      },
      "id": "8a32ee5e-2a66-46da-8667-a1d8ecef11f5",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "position": [
        -40,
        4100
      ],
      "webhookId": "1d758ef5-a9b9-4313-b81e-1c7dfe230a33",
      "typeVersion": 2,
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.body.event_data.project_id }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "project1"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "759db81d-4d1a-463f-9773-1db73b6a7829",
                    "operator": {
                      "name": "filter.operator.equals",
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.body.event_data.project_id }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "project2"
            }
          ]
        },
        "options": {}
      },
      "id": "8a2d524f-bec0-4a5f-8bda-14874d66e895",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "position": [
        180,
        4100
      ],
      "typeVersion": 3.2,
      "disabled": true
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "mode": "id",
          "value": ""
        },
        "options": {}
      },
      "id": "19b58d21-4746-46fa-ab47-241ed0a3bf04",
      "name": "Execute Workflow1",
      "type": "n8n-nodes-base.executeWorkflow",
      "position": [
        400,
        4200
      ],
      "typeVersion": 1.1,
      "disabled": true
    },
    {
      "parameters": {
        "content": "### Replace trigger\nUse this trigger in the sub-workflows instead",
        "height": 280,
        "width": 220
      },
      "id": "a0af2150-d409-4967-b620-888e6e244af7",
      "name": "Sticky Note50",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -380,
        4000
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Register Webhook\nConfigure this webhook in the Todoist App as mentioned above",
        "height": 300,
        "width": 220
      },
      "id": "57a6bf55-fe00-4015-846e-ca74c560933f",
      "name": "Sticky Note68",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -100,
        3980
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Set project IDs and names\nCopy each project ID from the JSON of the different Globals Nodes and name the branches by the projects.",
        "height": 340,
        "width": 220
      },
      "id": "54ddb8fe-23e7-4eff-8694-04e55539a4f6",
      "name": "Sticky Note69",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        120,
        3940
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "### Select sub-workflows\nChoose the sub-workflows based on the branch of the Switch Node",
        "height": 500,
        "width": 220
      },
      "id": "cbd89b0a-4c64-4186-85c0-31c220487b94",
      "name": "Sticky Note70",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        340,
        3880
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 0. Start here\n### Notion\n- A database must already exist (get a basic template [here](https://steadfast-banjo-d1f.notion.site/17682b476c848086b002de766879aa71)) with the following properties (case matters!):\n  - Text: \"Name\"\n  - Status: \"Status\", containing at least the options \"Backlog\", \"In progress\", \"Done\", \"Obsolete\"\n  - Select: \"Priority\", containing the options \"do first\", \"urgent\", \"important\"\n  - Date: \"Due\"\n  - Checkbox: \"Focus\"\n  - Text: \"Todoist ID\"\n### Todoist\n- A project must already exist with the same sections like defined as Status in Notion (except Done and Obsolete)\n### Redis\n- Create a [Free Redis Cloud](https://redis.io/try-free/) instance or self-host\n### Setup credentials in n8n\n- Notion: https://docs.n8n.io/integrations/builtin/credentials/notion/\n- Todoist: https://docs.n8n.io/integrations/builtin/credentials/todoist/\n- Redis: https://docs.n8n.io/integrations/builtin/credentials/redis/\n### Clone workflow\n- Clone this workflow into your n8n environment and map the credentials (beware, Todoist credentials are also used in HTTP request nodes)\n- Check for every yellow sticky notes. They show instructions which need to be done once",
        "height": 560,
        "width": 980
      },
      "id": "eb96356a-f73b-4b4b-9023-a63403305be4",
      "name": "Sticky Note72",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5040,
        -20
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 1. Generate config JSON for Globals Nodes\nThe sync workflows have a Node named \"Globals\", which contain mapping information for both Notion and Todoist. This flow helps to generate the config, using a multi-form.\n### How to use\n- Check if the credentials in the Notion and HTTP Request Nodes are set correctly\n- Activate this workflow\n- Open production URL of the form trigger and complete the form\n- Copy the resulting JSON code into all 3 \"Globals\" nodes",
        "height": 460,
        "width": 2780
      },
      "id": "ae068f59-0c92-49dd-9f0f-109368de25de",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5040,
        560
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 2. Setup Todoist Webhook\n- In the Todoist App open Settings > Integrations > Developer > Build Integrations\n- Click \"Create a new app\"\n  - App name: \"Notion-Todoist Sync\" / Name of your n8n instance\n  - App service URL: (leave empty)\n- Click \"Create app\"\n- Update settings of the app:\n  - OAuth redirect URL: Grab the production URL of the \"OAuth redirect\" Node (from step 3 on the right)\n- Click on \"Save settings\", leave tab open\n\n- Activate this workflow\n- Open the Production URL of the \"Todoist Webhook Setup Helper\" Node (from step 3 on the right)\n- Copy the Client ID and secret from the App settings into the form and submit it\n- When prompted for permissions, click on \"Agree\"\n\n- Go back to App settings tab\n- Scroll further down to \"Webhook\"\n- Update settings of the app:\n  - Webhook callback URL: Grab the production URL of the \"Todoist Webhook\" Node (Todoist to Notion Diff sync)\n  - Select these options:\n    - item:added\n    - item:updated\n    - item:completed\n    - item:uncompleted\n    - item:deleted\n- Click \"Save webhook configuration\"\n- Click \"Activate webhook\"\n- Settings can now be closed",
        "height": 680,
        "width": 800
      },
      "id": "28b5ae7e-eeac-433c-9183-93dd01874604",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -5040,
        1040
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 4. Setup Notion Webhook\nYou can choose from two options and also choose different options for different workspaces, e.g. optionA for a business related workspace and option B for a private workspace. Both options work similarly, option A is a bit easier to setup, yet it is more expensive.\n\n## Option A: Notion Webhook via Automation (paid plan required)\n- Create a new [automation](https://www.notion.com/help/database-automations) on the database which should be synced\n- Rename the automation to \"Notion-Todoist Sync\" or similar\n- Add trigger: \"Any property edited\"\n- Add action: \"Send webhook\"\n  - URL: Grab the production URL from the \"Notion Webhook\" Node of this workflow (Notion to Todoist Diff sync)\n  - Content: Select all existing properties\n- Click \"Save\"\n\n## Option B: Notion Webhook Emulator (no subscription required)\n- Follow the instructions here: https://n8n.io/workflows/2284-provide-real-time-updates-for-notion-databases-via-webhooks-with-supabase/\n- Use the Webhook URL from the \"Notion Webhook\" Node of this workflow to push the updates to",
        "height": 680,
        "width": 800
      },
      "id": "9e1565b1-a44c-4ad1-a3b1-ae4585f383b1",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3060,
        1040
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 3. Activate Todoist Webhook\nWebhooks are a bit different in Todoist then usual. A Developer App needs to be created and once be connected to via OAuth, to activate the webhook functionality.\nThis flow only works when using the **production URL** of it's form trigger.",
        "height": 680,
        "width": 1140
      },
      "id": "a413fca5-7ca2-4ac7-a0c4-2358b09b6515",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -4220,
        1040
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "9e948541-8c3b-4b99-99ab-0966319500ac",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              },
              "leftValue": "={{ $if($('Map Todoist to Notion1').item.json.due !== null, $('Map Todoist to Notion1').item.json.due.toDateTime().toISO(), null) }}",
              "rightValue": "null"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "16aad4f7-5ec3-426c-ac6a-2778c62611a2",
      "name": "Due date empty",
      "type": "n8n-nodes-base.filter",
      "position": [
        4300,
        3380
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "a8595a9c-fc03-4bb1-b1fc-ecde223d19aa",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              },
              "leftValue": "={{ $('Get Todoist Task1').item.json.is_completed }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "10b7fa07-4c38-43f1-94ce-df44d7eaf9d0",
      "name": "Has not been completed?",
      "type": "n8n-nodes-base.if",
      "position": [
        4080,
        3660
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {},
      "id": "dd996494-c2a8-4b54-9dd2-8cd9438342e8",
      "name": "End here",
      "type": "n8n-nodes-base.noOp",
      "position": [
        2060,
        3420
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "errorMessage": "Retry limit reached"
      },
      "id": "da79fd7f-748c-4b61-ae44-433ce640cbba",
      "name": "Retry limit reached",
      "type": "n8n-nodes-base.stopAndError",
      "position": [
        1200,
        580
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
              "name": "tries",
              "type": "number",
              "value": "={{ $json.tries || 0 }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "38bf6966-9cad-4c20-aa5c-b2aecaaca0fb",
      "name": "Set tries",
      "type": "n8n-nodes-base.set",
      "position": [
        1200,
        280
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
              "name": "tries",
              "type": "number",
              "value": "={{ $('Set tries').item.json.tries + 1 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "a58b20ec-d039-4beb-873f-479aae672ca3",
      "name": "Update tries",
      "type": "n8n-nodes-base.set",
      "position": [
        2080,
        580
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {},
      "id": "2ed11dad-6368-492e-bbe1-09af37d356a9",
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "position": [
        1860,
        580
      ],
      "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
              "operator": {
                "type": "string",
                "operation": "contains"
              },
              "leftValue": "={{ $json.error }}",
              "rightValue": "could not be found"
            }
          ]
        },
        "options": {}
      },
      "id": "d9aeb330-6e7b-4aed-8b39-a4d1abfde3f1",
      "name": "Catch known error",
      "type": "n8n-nodes-base.if",
      "position": [
        1640,
        380
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
              "operator": {
                "type": "number",
                "operation": "lt"
              },
              "leftValue": "={{ $json.tries }}",
              "rightValue": 3
            }
          ]
        },
        "options": {}
      },
      "id": "5d7f1e2e-1c35-4298-aa5b-94a695859c95",
      "name": "If tries left",
      "type": "n8n-nodes-base.if",
      "position": [
        980,
        580
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "Retrieve Todoist task, which can be completed or deleted at this point.\nUsing advanced retry logic, since the \"Get many tasks\" endpoint does not return completed tasks.",
        "height": 480,
        "width": 1320,
        "color": 7
      },
      "id": "e49181bc-de9f-456a-846f-0e1aa74e1198",
      "name": "Sticky Note18",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3320,
        3620
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "errorMessage": "Retry limit reached"
      },
      "id": "90d157da-dab1-441b-a9fe-51856b3d2b29",
      "name": "Retry limit reached1",
      "type": "n8n-nodes-base.stopAndError",
      "position": [
        -3040,
        3900
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
              "name": "tries",
              "type": "number",
              "value": "={{ $json.tries || 0 }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "896c4220-f7cc-4562-90bd-0dc606574233",
      "name": "Set tries1",
      "type": "n8n-nodes-base.set",
      "position": [
        -3040,
        3700
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
              "name": "tries",
              "type": "number",
              "value": "={{ $('Set tries1').item.json.tries + 1 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "26a2dc85-f578-4f0b-9ac5-570746826193",
      "name": "Update tries1",
      "type": "n8n-nodes-base.set",
      "position": [
        -2160,
        3900
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {},
      "id": "0f955c54-6cdf-428b-ac49-804821984f41",
      "name": "Wait1",
      "type": "n8n-nodes-base.wait",
      "position": [
        -2380,
        3900
      ],
      "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
              "operator": {
                "type": "string",
                "operation": "contains"
              },
              "leftValue": "={{ $json.error }}",
              "rightValue": "could not be found"
            }
          ]
        },
        "options": {}
      },
      "id": "0d0b0bab-03ac-464e-bf73-5460e41bdb42",
      "name": "Catch known error1",
      "type": "n8n-nodes-base.if",
      "position": [
        -2600,
        3800
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
              "operator": {
                "type": "number",
                "operation": "lt"
              },
              "leftValue": "={{ $json.tries }}",
              "rightValue": 3
            }
          ]
        },
        "options": {}
      },
      "id": "0f909bf6-8f16-411e-a372-7638affe443b",
      "name": "If tries left1",
      "type": "n8n-nodes-base.if",
      "position": [
        -3260,
        3900
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "Todoist webhooks can arrive late. To ensure the data is up to date, the payload must be retrieved again. Triggers on deletion can overlap, thus try 3 times, then just stop.\nUsing advanced retry logic, since the \"Get many tasks\" endpoint does not return completed tasks.\nNo more retries needed, if Task does not exist.",
        "height": 600,
        "width": 1320,
        "color": 7
      },
      "id": "5c3ba6db-2e26-43a6-bd12-bd3f6f9273b9",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1120,
        3220
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cd93a7f6-4c06-4e8a-8d0d-e812c5ec4bc5",
              "name": "tries",
              "type": "number",
              "value": "={{ $json.tries || 0 }}"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "9dd8c9d3-5b22-4eef-b593-1541a30948f4",
      "name": "Set tries2",
      "type": "n8n-nodes-base.set",
      "position": [
        1400,
        3320
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "df3c9b29-afa6-4e08-868d-5b7e8202eefa",
              "name": "tries",
              "type": "number",
              "value": "={{ $('Set tries2').item.json.tries + 1 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "aead1619-bdf2-4d0f-a69b-6d66ff21e2f8",
      "name": "Update tries2",
      "type": "n8n-nodes-base.set",
      "position": [
        2280,
        3620
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {},
      "id": "967b7f85-896e-485a-a9f0-db7148389d3d",
      "name": "Wait2",
      "type": "n8n-nodes-base.wait",
      "position": [
        2060,
        3620
      ],
      "webhookId": "9d3b561f-4afd-478c-8f6e-60641d4f1d0b",
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "6a379b06-0b04-4ae4-9bf9-394bd40744b7",
              "operator": {
                "type": "string",
                "operation": "contains"
              },
              "leftValue": "={{ $json.error }}",
              "rightValue": "could not be found"
            }
          ]
        },
        "options": {}
      },
      "id": "12665ac7-b954-4e14-9a5f-204036942ccb",
      "name": "Catch known error2",
      "type": "n8n-nodes-base.if",
      "position": [
        1840,
        3420
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b18f784a-4386-4ced-a9e1-ce5a21ad036e",
              "operator": {
                "type": "number",
                "operation": "lt"
              },
              "leftValue": "={{ $json.tries }}",
              "rightValue": 3
            }
          ]
        },
        "options": {}
      },
      "id": "76e54e46-bd1b-48b1-9a49-3cde7bb1828b",
      "name": "If tries left2",
      "type": "n8n-nodes-base.if",
      "position": [
        1180,
        3620
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "errorMessage": "Retry limit reached"
      },
      "id": "161d8508-f2d6-476a-a75c-223193f648fb",
      "name": "Retry limit reached2",
      "type": "n8n-nodes-base.stopAndError",
      "position": [
        1400,
        3620
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Overwrite description with Notion URL",
        "height": 240,
        "width": 220,
        "color": 7
      },
      "id": "78f805a5-306a-43e9-bb8c-f8af607a8621",
      "name": "Sticky Note30",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4680,
        2700
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Get the markdown from the input\nconst markdown = $('Get Todoist Task').item.json.description || '';\n\n// Split the markdown into lines and remove empty lines\nconst lines = markdown.split('\\n').filter(line => line.trim());\n\n// Initialize result array\nconst result = [];\n\n// Helper function to split long text into chunks\nfunction splitIntoChunks(text, maxLength) {\n    const chunks = [];\n    let remaining = text;\n    \n    while (remaining.length > maxLength) {\n        // Find the last space before maxLength\n        let splitIndex = remaining.lastIndexOf(' ', maxLength);\n        // If no space found, force split at maxLength\n        if (splitIndex === -1) splitIndex = maxLength;\n        \n        chunks.push(remaining.substring(0, splitIndex).trim());\n        remaining = remaining.substring(splitIndex).trim();\n    }\n    \n    if (remaining.length > 0) {\n        chunks.push(remaining);\n    }\n    \n    return chunks;\n}\n\nfor (const line of lines) {\n    const trimmedLine = line.trim();\n    \n    // Skip if empty line\n    if (!trimmedLine) continue;\n    \n    // Check for different types of markdown elements\n    if (trimmedLine.startsWith('# ')) {\n        result.push({\n            type: 'heading_1',\n            content: trimmedLine.substring(2).trim()\n        });\n    }\n    else if (trimmedLine.startsWith('## ')) {\n        result.push({\n            type: 'heading_2',\n            content: trimmedLine.substring(3).trim()\n        });\n    }\n    else if (trimmedLine.startsWith('### ')) {\n        result.push({\n            type: 'heading_3',\n            content: trimmedLine.substring(4).trim()\n        });\n    }\n    else if (trimmedLine.match(/^\\d+\\./)) {\n        result.push({\n            type: 'numbered_list_item',\n            content: trimmedLine.replace(/^\\d+\\.\\s*/, '').trim()\n        });\n    }\n    else if (trimmedLine.startsWith('- ')) {\n        result.push({\n            type: 'bulleted_list_item',\n            content: trimmedLine.substring(2).trim()\n        });\n    }\n    else {\n        // For paragraphs, check if they need to be split\n        if (trimmedLine.length > 2000) {\n            const chunks = splitIntoChunks(trimmedLine, 2000);\n            for (const chunk of chunks) {\n                result.push({\n                    type: 'paragraph',\n                    content: chunk\n                });\n            }\n        } else {\n            result.push({\n                type: 'paragraph',\n                content: trimmedLine\n            });\n        }\n    }\n}\n\n// Return the result in the format n8n expects\nreturn { blocks: result };\n"
      },
      "id": "24fb9dbd-2088-42a1-a3b7-a5de2b13d4f8",
      "name": "Turn Markdown into Notion Blocks",
      "type": "n8n-nodes-base.code",
      "position": [
        4520,
        2520
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "fieldToSplitOut": "blocks",
        "options": {}
      },
      "id": "ad1349b8-448d-4d42-8e68-d700baa36616",
      "name": "Handle each block separately",
      "type": "n8n-nodes-base.splitOut",
      "position": [
        4740,
        2520
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "resource": "block",
        "blockId": {
          "__rl": true,
          "mode": "id",
          "value": "={{ $('Create task in Notion').item.json.id }}"
        },
        "blockUi": {
          "blockValues": [
            {
              "type": "={{ $json.type }}",
              "textContent": "={{ $json.content }}"
            }
          ]
        }
      },
      "id": "b018701e-1e01-4756-a6ac-5a30f0dfbb9e",
      "name": "Append Notion Block",
      "type": "n8n-nodes-base.notion",
      "position": [
        4960,
        2520
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "content": "Copy task description initially to Notion, before it get's replaced in Todoist by the Notion URL",
        "height": 240,
        "width": 660,
        "color": 7
      },
      "id": "15f1cacf-c385-4c10-87a3-d4f5f792332a",
      "name": "Sticky Note34",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4460,
        2460
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "# 5. Finishing Touches\n\n### Cleanup\nNow technically everything is ready, but it is missing better usability and maintainability. So start by moving (cut & paste) the 3 big flows (outlined in blue) to separate n8n workflows. You can name them as follows:\n- Notion-Todoist Full Sync (<workspace-name>)\n- Notion-Todoist Diff Sync (<workspace-name>)\n- Todoist-Notion Diff Sync (<workspace-name>)\n \nMake sure to **activate every workflow** which requires it.\nAlso save this workflow to avoid duplicates.\n\n### First run\n- Execute the **Notion-Todoist Full Sync** workflow manually first\n- Now that the initial sync is done and you can start using the realtime sync",
        "height": 380,
        "width": 800
      },
      "id": "a6e84825-3aed-4e25-b352-38fa26827be5",
      "name": "Sticky Note40",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3060,
        1740
      ],
      "typeVersion": 1
    }
  ],
  "pinData": {},
  "connections": {
    "Wait": {
      "main": [
        [
          {
            "node": "Update tries",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge summary",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Update tries1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Update tries2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion": {
      "main": [
        [
          {
            "node": "Map Notion to Todoist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Execute Workflow",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Workflow1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist": {
      "main": [
        [
          {
            "node": "Pick Todoist Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Update section (Sync API)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set tries": {
      "main": [
        [
          {
            "node": "Get Todoist Task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set tries1": {
      "main": [
        [
          {
            "node": "Get Todoist Task2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set tries2": {
      "main": [
        [
          {
            "node": "Get Todoist Task1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract IDs": {
      "main": [
        [
          {
            "node": "Notion trigger reference",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get projects": {
      "main": [
        [
          {
            "node": "Prep Dropdown1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get sections": {
      "main": [
        [
          {
            "node": "Generate config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update tries": {
      "main": [
        [
          {
            "node": "If tries left",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate UUID": {
      "main": [
        [
          {
            "node": "Prepare Batching Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get variables": {
      "main": [
        [
          {
            "node": "Verify security token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If tries left": {
      "main": [
        [
          {
            "node": "Set tries",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Retry limit reached",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge summary": {
      "main": [
        [
          {
            "node": "Filter out status changes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prep Dropdown": {
      "main": [
        [
          {
            "node": "Choose Notion Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update tries1": {
      "main": [
        [
          {
            "node": "If tries left1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update tries2": {
      "main": [
        [
          {
            "node": "If tries left2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add project ID": {
      "main": [
        [
          {
            "node": "If Todoist ID exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Body is array?": {
      "main": [
        [
          {
            "node": "Split out Notion changes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Notion trigger reference",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Due date empty": {
      "main": [
        [
          {
            "node": "Mark as Focussed in Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data": {
      "main": [
        [
          {
            "node": "Check if Todoist ID is locked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate UUID1": {
      "main": [
        [
          {
            "node": "Update section (Sync API)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate UUID2": {
      "main": [
        [
          {
            "node": "Update section (Sync API)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get todoist ID": {
      "main": [
        [
          {
            "node": "Lock Todoist ID4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If tries left1": {
      "main": [
        [
          {
            "node": "Set tries1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Retry limit reached1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If tries left2": {
      "main": [
        [
          {
            "node": "Set tries2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Retry limit reached2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion Webhook": {
      "main": [
        [
          {
            "node": "Body is array?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OAuth redirect": {
      "main": [
        [
          {
            "node": "Get variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prep Dropdown1": {
      "main": [
        [
          {
            "node": "Choose Todoist Project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status changed": {
      "main": [
        [
          {
            "node": "Get mapped item1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status is Done": {
      "main": [
        [
          {
            "node": "Mark as Completed in Todoist",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Task in Todoist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Exchange Tokens": {
      "main": [
        [
          {
            "node": "Respond with success",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond with error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data1": {
      "main": [
        [
          {
            "node": "Get Notion Task1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data2": {
      "main": [
        [
          {
            "node": "Update Description in Todoist",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data3": {
      "main": [
        [
          {
            "node": "Switch by Event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data4": {
      "main": [
        [
          {
            "node": "Mark as Obsolete in Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data5": {
      "main": [
        [
          {
            "node": "Check if Notion ID is locked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data6": {
      "main": [
        [
          {
            "node": "Status is Obsolete?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate config": {
      "main": [
        [
          {
            "node": "Return config JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion Task": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion task": {
      "main": [
        [
          {
            "node": "Map Notion to Todoist2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get mapped item": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get todoist ID1": {
      "main": [
        [
          {
            "node": "Lock Todoist ID4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Exists/Completed in Notion",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Notion Task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store variables": {
      "main": [
        [
          {
            "node": "Redirect to Auth Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch by Event": {
      "main": [
        [
          {
            "node": "Differences exist1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Description has changed in Todoist",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Requires completion change1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Requires completion change1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist Webhook": {
      "main": [
        [
          {
            "node": "Switch by project",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compare Datasets": {
      "main": [
        [
          {
            "node": "Handle empty dates2",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Handle empty dates",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion Task1": {
      "main": [
        [
          {
            "node": "Notion Task not found",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion Task2": {
      "main": [
        [
          {
            "node": "Notion Task found1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Todoist Task": {
      "main": [
        [
          {
            "node": "Mark as Incomplete in Todoist",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Catch known error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get mapped item1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Get mapped item2": {
      "main": [
        [
          {
            "node": "Merge summary",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Generate UUID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Notion",
            "type": "main",
            "index": 0
          },
          {
            "node": "Todoist",
            "type": "main",
            "index": 0
          },
          {
            "node": "Globals",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Todoist ID": {
      "main": [
        [
          {
            "node": "Get mapped item2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Catch known error": {
      "main": [
        [
          {
            "node": "Create task in Todoist",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Differences exist": {
      "main": [
        [
          {
            "node": "Update task in Todoist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Todoist Task1": {
      "main": [
        [
          {
            "node": "Map Todoist to Notion1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Catch known error2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Todoist Task2": {
      "main": [
        [
          {
            "node": "Differences exist",
            "type": "main",
            "index": 0
          },
          {
            "node": "Requires completion change",
            "type": "main",
            "index": 0
          },
          {
            "node": "Status changed but not empty",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Catch known error1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set creating flag": {
      "main": [
        [
          {
            "node": "Create task in Todoist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch by project": {
      "main": [
        [
          {
            "node": "Todoist trigger reference",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist ID exists": {
      "main": [
        [
          {
            "node": "Delete Task in Todoist2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Catch known error1": {
      "main": [
        [
          {
            "node": "Status is not Done",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Catch known error2": {
      "main": [
        [
          {
            "node": "End here",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Differences exist1": {
      "main": [
        [
          {
            "node": "Update task in Notion",
            "type": "main",
            "index": 0
          },
          {
            "node": "Due date empty",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle empty dates": {
      "main": [
        [
          {
            "node": "Update Task in Todoist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map summary fields": {
      "main": [
        [
          {
            "node": "Convert to HTML Table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion Task found1": {
      "main": [
        [
          {
            "node": "Execution Data4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set creating flag1": {
      "main": [
        [
          {
            "node": "Get Backlog Section ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status is not Done": {
      "main": [
        [
          {
            "node": "Check if creating flag exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist ID exists?": {
      "main": [
        [
          {
            "node": "Set tries1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check if creating flag exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append Notion Block": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate email body": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle empty dates1": {
      "main": [
        [
          {
            "node": "Update task in Todoist before closing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle empty dates2": {
      "main": [
        [
          {
            "node": "Add project ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has been completed?": {
      "main": [
        [
          {
            "node": "Mark as Completed in Todoist1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mark as Incomplete in Todoist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pick Todoist Fields": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Status is Obsolete?": {
      "main": [
        [
          {
            "node": "Todoist ID exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Neither focussed nor planned",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion Databases": {
      "main": [
        [
          {
            "node": "Prep Dropdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Todoist ID exists": {
      "main": [
        [
          {
            "node": "Set tries",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create task in Todoist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare summary data": {
      "main": [
        [
          {
            "node": "Merge summary",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Convert to HTML Table": {
      "main": [
        [
          {
            "node": "Generate email body",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create task in Notion": {
      "main": [
        [
          {
            "node": "Execution Data2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Turn Markdown into Notion Blocks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Notion to Todoist": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Todoist to Notion": {
      "main": [
        [
          {
            "node": "Map summary fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion Task not found": {
      "main": [
        [
          {
            "node": "Check if creating flag exists1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execution Data3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare summary data1": {
      "main": [
        [
          {
            "node": "Merge summary",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Prepare summary data2": {
      "main": [
        [
          {
            "node": "Merge summary",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "Update task in Notion": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verify security token": {
      "main": [
        [
          {
            "node": "Exchange Tokens",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond with error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Choose Notion Database": {
      "main": [
        [
          {
            "node": "Get Notion Database ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Choose Todoist Project": {
      "main": [
        [
          {
            "node": "Get Todoist Project ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create task in Todoist": {
      "main": [
        [
          {
            "node": "Store Todoist ID",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Task in Todoist": {
      "main": [
        [
          {
            "node": "Prepare summary data2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Backlog Section ID": {
      "main": [
        [
          {
            "node": "Generate UUID1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create task in Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Notion Database ID": {
      "main": [
        [
          {
            "node": "Get projects",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Todoist Project ID": {
      "main": [
        [
          {
            "node": "Get sections",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Notion to Todoist1": {
      "main": [
        [
          {
            "node": "Handle empty dates1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Notion to Todoist2": {
      "main": [
        [
          {
            "node": "Execution Data6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Map Todoist to Notion1": {
      "main": [
        [
          {
            "node": "Execution Data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Done in Notion": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Batching Items": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Task in Todoist": {
      "main": [
        [
          {
            "node": "Status changed",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Todoist ID2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare summary data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update task in Todoist": {
      "main": [
        [
          {
            "node": "Get mapped item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create task in Todoist1": {
      "main": [
        [
          {
            "node": "Store Todoist ID1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Todoist ID4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Task in Todoist2": {
      "main": [
        [
          {
            "node": "Get todoist ID1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate security token": {
      "main": [
        [
          {
            "node": "Store variables",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has not been completed?": {
      "main": [
        [
          {
            "node": "Mark as In Progress in Notion",
            "type": "main",
            "index": 0
          },
          {
            "node": "Neither focussed nor planned1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mark as Done in Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update task in Todoist1": {
      "main": [
        [
          {
            "node": "Get todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If event is not :deleted": {
      "main": [
        [
          {
            "node": "Set tries2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Notion Task2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion trigger reference": {
      "main": [
        [
          {
            "node": "Globals2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Execution Data5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split out Notion changes": {
      "main": [
        [
          {
            "node": "Extract IDs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter out status changes": {
      "main": [
        [
          {
            "node": "Map Todoist to Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist trigger reference": {
      "main": [
        [
          {
            "node": "Execution Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Globals1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update section (Sync API)": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Exists/Completed in Notion": {
      "main": [
        [
          {
            "node": "Map Notion to Todoist1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete Task in Todoist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Focussed in Notion": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Obsolete in Notion": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Requires completion change": {
      "main": [
        [
          {
            "node": "Has been completed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update section (Sync API)2": {
      "main": [
        [
          {
            "node": "Get todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Only continue if not locked": {
      "main": [
        [
          {
            "node": "If event is not :deleted",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Requires completion change1": {
      "main": [
        [
          {
            "node": "Has not been completed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Notion ID is locked": {
      "main": [
        [
          {
            "node": "Only continue if not locked1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle each block separately": {
      "main": [
        [
          {
            "node": "Append Notion Block",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Completed in Todoist": {
      "main": [
        [
          {
            "node": "Prepare summary data1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neither focussed nor planned": {
      "main": [
        [
          {
            "node": "Todoist ID exists",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Todoist ID exists?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Only continue if not locked1": {
      "main": [
        [
          {
            "node": "Get Notion task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status changed but not empty": {
      "main": [
        [
          {
            "node": "Generate UUID2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Todoist Webhook Setup Helper": {
      "main": [
        [
          {
            "node": "Generate security token",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Todoist ID is locked": {
      "main": [
        [
          {
            "node": "Only continue if not locked",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if creating flag exists": {
      "main": [
        [
          {
            "node": "Only continue if flag does not exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Completed in Todoist1": {
      "main": [
        [
          {
            "node": "Get todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as In Progress in Notion": {
      "main": [
        [
          {
            "node": "Lock Notion ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Incomplete in Todoist": {
      "main": [
        [
          {
            "node": "Update task in Todoist",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neither focussed nor planned1": {
      "main": [
        [
          {
            "node": "Mark as Focussed in Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if creating flag exists1": {
      "main": [
        [
          {
            "node": "Only continue if flag does not exist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mark as Incomplete in Todoist1": {
      "main": [
        [
          {
            "node": "Get todoist ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion-Todoist Sync Setup Helper": {
      "main": [
        [
          {
            "node": "Get Notion Databases",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Turn Markdown into Notion Blocks": {
      "main": [
        [
          {
            "node": "Handle each block separately",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Description has changed in Todoist": {
      "main": [
        [
          {
            "node": "Update Description in Todoist1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Only continue if flag does not exist": {
      "main": [
        [
          {
            "node": "Set creating flag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Only continue if flag does not exist1": {
      "main": [
        [
          {
            "node": "Set creating flag1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update task in Todoist before closing": {
      "main": [
        [
          {
            "node": "Status is Done",
            "type": "main",
            "index": 0
          },
          {
            "node": "Lock Todoist ID1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "02495bdc-6d05-49a1-b86f-2979747fdedd",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c49880621b47b7272aa465465eae95e198d1a2bafce89b9928afc1be5e9abe54"
  },
  "id": "nFnGzj9MLeAFUnxR",
  "tags": []
}